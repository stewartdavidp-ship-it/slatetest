<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="version" content="1.0.16">
    <title>Slate - Daily Word Challenge</title>
    
    <!-- PWA Support -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2a4a3a">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Slate">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìù</text></svg>">
    
    <link href="https://fonts.googleapis.com/css2?family=Special+Elite&family=Permanent+Marker&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Roboto Mono', monospace;
            background: #1a3a2a;
            background-image:
                radial-gradient(circle at 20% 30%, rgba(100,180,100,0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(80,140,100,0.08) 0%, transparent 50%),
                linear-gradient(135deg, #1a3a2a 0%, #2a4a3a 50%, #1a3a2a 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            /* PWA safe area support */
            padding: env(safe-area-inset-top, 0px) env(safe-area-inset-right, 0px) env(safe-area-inset-bottom, 0px) env(safe-area-inset-left, 0px);
            padding: 20px;
            color: #e8e6e3;
        }

        /* Chalkboard texture overlay */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(255,255,255,0.03) 2px, rgba(255,255,255,0.03) 4px),
                repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(255,255,255,0.03) 2px, rgba(255,255,255,0.03) 4px);
            pointer-events: none;
            opacity: 0.3;
        }

        .container {
            max-width: 700px;
            width: 100%;
            background: #2d4d3d;
            border: 8px solid #6d5d45;
            border-radius: 4px;
            box-shadow:
                0 20px 60px rgba(0,0,0,0.6),
                inset 0 0 100px rgba(0,0,0,0.2);
            padding: 40px;
            position: relative;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid rgba(255,255,255,0.1);
            padding-bottom: 20px;
            position: relative;
        }

        .back-button {
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(90,125,90,0.3);
            border: 2px solid rgba(255,255,255,0.15);
            border-radius: 8px;
            font-size: 0.85rem;
            color: #f4e4c1;
            cursor: pointer;
            padding: 8px 12px;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .back-button:hover {
            background: rgba(90,125,90,0.5);
            border-color: rgba(255,255,255,0.3);
            transform: translateY(-50%) scale(1.05);
        }

        .back-button .back-text {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }

        @media (max-width: 400px) {
            .back-button .back-text {
                display: none;
            }
        }

        .menu-button {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(90,125,90,0.3);
            border: 2px solid rgba(255,255,255,0.15);
            border-radius: 8px;
            font-size: 1.5rem;
            color: #f4e4c1;
            cursor: pointer;
            padding: 8px 12px;
            transition: all 0.2s ease;
        }

        .menu-button:hover {
            background: rgba(90,125,90,0.5);
            border-color: rgba(255,255,255,0.3);
            transform: translateY(-50%) scale(1.05);
        }

        .difficulty-toggle {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 15px 0;
        }

        .difficulty-btn {
            padding: 12px 30px;
            font-size: 1rem;
            font-family: 'Special Elite', cursive;
            background: rgba(255, 255, 255, 0.1);
            color: #c9b896;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 100px;
        }

        .difficulty-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .difficulty-btn.active {
            background: #5a7d5a;
            color: #fff;
            border-color: #4a6d4a;
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
            flex-shrink: 0;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #4a3a3a;
            transition: 0.3s;
            border-radius: 26px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: #c9b896;
            transition: 0.3s;
            border-radius: 50%;
        }

        .toggle-switch input:checked + .toggle-slider {
            background-color: #5a7d5a;
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        h1 {
            font-family: 'Permanent Marker', cursive;
            font-size: 3.5rem;
            color: #f4e4c1;
            text-shadow:
                2px 2px 0 rgba(0,0,0,0.3),
                4px 4px 10px rgba(0,0,0,0.5);
            letter-spacing: 0.1em;
            margin-bottom: 10px;
        }

        .subtitle {
            font-family: 'Special Elite', cursive;
            color: #c9b896;
            font-size: 0.9rem;
            letter-spacing: 0.2em;
            text-transform: uppercase;
        }

        .score-display {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 4px;
            font-size: 1.2rem;
            color: #f4e4c1;
        }

        .score-display strong {
            color: #ffd700;
            font-size: 1.5rem;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr) 60px;
            gap: 8px;
            margin: 30px 0;
            padding: 20px;
            background: rgba(0,0,0,0.2);
            border-radius: 4px;
        }

        .word-score {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 700;
            font-family: 'Permanent Marker', cursive;
            color: #f4e4c1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .word-score.visible {
            opacity: 1;
        }

        .cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: 700;
            font-family: 'Special Elite', cursive;
            background: #2a3439;
            border: 2px solid #4a5a64;
            border-radius: 4px;
            color: #f4e4c1;
            text-transform: uppercase;
            transition: all 0.3s ease;
            cursor: default;
            position: relative;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .cell.clickable {
            cursor: pointer;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .cell.clickable:active {
            transform: scale(0.95);
            background: rgba(90, 125, 90, 0.4);
        }

        .cell.vowel {
            background: #3a4d3a;
            border-color: #5a7d5a;
            color: #a8d5a8;
        }

        .cell.consonant {
            background: #4a3a3a;
            border-color: #7a5a5a;
            color: #d5a8a8;
            animation: reveal 0.5s ease;
        }

        .cell.guessed {
            background: #4a7a5a;
            border-color: #5a9a7a;
            color: #fff;
            box-shadow: 0 0 20px rgba(90, 154, 122, 0.5);
            font-weight: 700;
        }

        .cell.failed {
            background: #7a3a3a;
            border-color: #9a4a4a;
            color: #ffaaaa;
            box-shadow: 0 0 15px rgba(154, 74, 74, 0.4);
            font-weight: 700;
        }

        .word-score.failed {
            color: #ff6666;
        }

        .cell.empty {
            background: #1a2329;
            border-color: #2a3a44;
        }

        .cell.selected {
            background: #4a5a7a;
            border-color: #6a8aaa;
            box-shadow: 0 0 20px rgba(106, 138, 170, 0.6);
            cursor: pointer;
        }

        .cell.clickable:hover {
            border-color: #5a7a9a;
            cursor: pointer;
        }

        @keyframes reveal {
            0% {
                transform: rotateY(90deg);
                opacity: 0;
            }
            100% {
                transform: rotateY(0);
                opacity: 1;
            }
        }

        .controls {
            margin: 30px 0;
        }

        .input-section {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }

        input {
            flex: 1;
            padding: 15px;
            font-size: 1.2rem;
            font-family: 'Special Elite', cursive;
            background: rgba(0,0,0,0.3);
            border: 2px solid #5a6a74;
            border-radius: 4px;
            color: #f4e4c1;
            text-transform: uppercase;
            letter-spacing: 0.2em;
        }

        input::placeholder {
            color: #7a8a94;
        }

        input:focus {
            outline: none;
            border-color: #a8d5a8;
            background: rgba(0,0,0,0.4);
        }

        button {
            padding: 15px 30px;
            font-size: 1rem;
            font-family: 'Roboto Mono', monospace;
            font-weight: 700;
            background: #5a7d5a;
            color: #fff;
            border: 2px solid #4a6d4a;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        button:hover {
            background: #6a8d6a;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(90, 125, 90, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .consonants {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-top: 20px;
            padding: 20px;
            background: rgba(0,0,0,0.2);
            border-radius: 4px;
        }

        .consonant-btn {
            padding: 12px;
            font-size: 1.1rem;
            font-family: 'Special Elite', cursive;
            background: #4a3a3a;
            color: #d5a8a8;
            border: 2px solid #5a4a4a;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            min-height: 44px;
        }

        .consonant-btn:hover:not(:disabled) {
            background: #5a4a4a;
            transform: scale(1.1);
        }

        .consonant-btn:active:not(:disabled) {
            transform: scale(0.95);
        }

        .consonant-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            background: #2a2a2a;
        }

        .consonant-btn.used {
            opacity: 0.4;
            cursor: not-allowed;
            background: #2a2a2a;
            color: #666;
            border-color: #3a3a3a;
        }

        .message {
            text-align: center;
            padding: 10px 15px;
            border-radius: 4px;
            font-size: 0.9rem;
            font-weight: 700;
            opacity: 0;
            transition: opacity 0.3s ease;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 100;
            pointer-events: none;
            max-width: 90%;
        }

        .message.show {
            opacity: 1;
        }

        .message.success {
            background: rgba(90, 125, 90, 0.3);
            color: #a8d5a8;
        }

        .message.error {
            background: rgba(125, 90, 90, 0.3);
            color: #d5a8a8;
        }

        .game-over {
            text-align: center;
            padding: 30px;
            background: rgba(0,0,0,0.4);
            border-radius: 4px;
            margin-top: 30px;
        }

        .game-over h2 {
            font-family: 'Permanent Marker', cursive;
            font-size: 2rem;
            color: #ffd700;
            margin-bottom: 20px;
        }

        .game-over .final-score {
            font-size: 3rem;
            color: #f4e4c1;
            margin: 20px 0;
            font-weight: 700;
        }

        @media (max-width: 600px) {
            .container {
                padding: 10px;
                margin: 5px;
                width: calc(100% - 10px);
            }

            h1 {
                font-size: 2rem;
            }
            
            .header {
                padding-bottom: 5px;
            }

            .subtitle {
                font-size: 0.75rem;
            }

            .menu-button {
                font-size: 1.3rem;
                padding: 6px 10px;
            }

            .score-display {
                font-size: 0.85rem;
                padding: 8px;
                margin: 5px 0;
            }

            .score-display strong {
                font-size: 1rem;
            }

            .grid {
                gap: 6px;
                padding: 8px;
                margin: 5px 0;
                grid-template-columns: repeat(5, 1fr) 50px;
            }

            .cell {
                font-size: 1.4rem;
            }

            .word-score {
                font-size: 1rem;
            }

            .consonants {
                grid-template-columns: repeat(7, 1fr);
                gap: 6px;
                padding: 8px;
                margin-top: 0;
            }
            
            .controls {
                margin: 5px 0;
            }
            
            .message {
                margin: 5px 0;
                padding: 8px;
            }

            .consonant-btn {
                padding: 10px 5px;
                font-size: 0.9rem;
            }

            /* Consonant selection modal - proper vertical scrolling */
            #consonant-modal .modal-content {
                padding: 15px;
                width: 90%;
                max-width: 320px;
                max-height: 85vh;
                overflow-y: auto;
                overflow-x: hidden;
                box-sizing: border-box;
            }
            
            /* Force grid to wrap into rows */
            #consonant-modal .modal-grid {
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 8px;
                width: 100%;
                box-sizing: border-box;
            }

            .modal-content h2 {
                font-size: 1.4rem;
            }

            .modal-content h3 {
                font-size: 1.1rem;
            }

            .modal-content p, .modal-content li {
                font-size: 0.9rem;
            }

            .modal-consonant-btn {
                padding: 12px 8px;
                font-size: 1rem;
                min-height: 44px;
                width: 100%;
                box-sizing: border-box;
            }
            
            .modal-title {
                font-size: 1.2rem;
                margin-bottom: 12px;
            }
            
            #selected-square-info {
                padding: 8px 10px;
                font-size: 0.9rem;
                margin-bottom: 10px;
            }
            
            .keyboard-tip {
                display: none;
            }
            
            .clear-letter-btn {
                padding: 10px;
                margin-top: 12px;
                font-size: 0.95rem;
            }

            .message {
                font-size: 0.9rem;
                padding: 10px;
            }
        }

        @media (max-width: 400px) {
            .container {
                padding: 10px;
                margin: 5px;
                width: calc(100% - 10px);
            }

            h1 {
                font-size: 1.8rem;
            }

            .grid {
                gap: 4px;
                padding: 8px;
                grid-template-columns: repeat(5, 1fr) 40px;
            }

            .cell {
                font-size: 1.2rem;
            }

            .word-score {
                font-size: 0.85rem;
            }

            .consonants {
                grid-template-columns: repeat(7, 1fr);
            }
        }
        
        /* Short screens (iPhone SE, etc.) */
        @media (max-height: 700px) {
            body {
                padding: 3px;
            }
            
            .container {
                padding: 5px;
                margin: 1px;
                border-width: 3px;
            }
            
            .header {
                margin-bottom: 2px;
                padding-bottom: 2px;
            }
            
            h1 {
                font-size: 1.4rem;
                margin-bottom: 0;
            }
            
            .subtitle {
                font-size: 0.55rem;
            }
            
            .score-display {
                padding: 4px;
                margin: 2px 0;
                font-size: 0.7rem;
            }
            
            .score-display strong {
                font-size: 0.8rem;
            }
            
            .grid {
                gap: 2px;
                padding: 3px;
                margin: 2px 0;
            }
            
            .cell {
                font-size: 0.95rem;
            }
            
            .word-score {
                font-size: 0.6rem;
            }
            
            .controls {
                margin: 1px 0;
            }
            
            .consonants {
                gap: 2px;
                padding: 3px;
                margin-top: 0;
            }
            
            .consonant-btn {
                padding: 4px 2px;
                font-size: 0.65rem;
                min-height: 24px;
            }
            
            .message {
                margin: 2px 0;
                padding: 5px;
                font-size: 0.75rem;
            }
        }

        @media (max-width: 400px) {
            #consonant-modal .modal-content {
                padding: 12px;
                width: 88%;
                max-width: 300px;
                max-height: 85vh;
            }
            
            #consonant-modal .modal-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 5px;
            }
            
            .modal-consonant-btn {
                padding: 8px 6px;
                font-size: 0.9rem;
                min-height: 38px;
            }
            
            .modal-title {
                font-size: 1rem;
                margin-bottom: 8px;
            }
            
            #selected-square-info {
                padding: 5px 8px;
                font-size: 0.8rem;
                margin-bottom: 6px;
            }
            
            .keyboard-tip {
                display: none;
            }
            
            .modal-close {
                padding: 10px 15px;
                font-size: 0.85rem;
                margin-top: 5px;
            }
            
            .clear-letter-btn {
                padding: 10px 15px;
                font-size: 0.9rem;
                margin-top: 10px;
            }
        }
        
        /* Even smaller screens */
        @media (max-width: 350px) {
            .container {
                padding: 8px;
                margin: 3px;
                width: calc(100% - 6px);
            }

            .grid {
                gap: 3px;
                padding: 6px;
                grid-template-columns: repeat(5, 1fr) 35px;
            }

            .cell {
                font-size: 1rem;
            }

            #consonant-modal .modal-content {
                padding: 10px;
                width: 85%;
                max-width: 280px;
                max-height: 88vh;
            }
            
            #consonant-modal .modal-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 4px;
            }
            
            .modal-consonant-btn {
                padding: 8px 4px;
                font-size: 0.85rem;
                min-height: 36px;
            }
            
            .modal-title {
                font-size: 0.95rem;
            }
            
            .clear-letter-btn {
                padding: 8px 12px;
                font-size: 0.85rem;
                margin-top: 8px;
            }
        }

        @media (min-width: 601px) and (max-width: 900px) {
            /* Tablet styles */
            .container {
                padding: 30px;
                max-width: 600px;
            }

            .grid {
                gap: 6px;
                padding: 15px;
            }

            .cell {
                font-size: 1.8rem;
            }

            .word-score {
                font-size: 1.3rem;
            }

            .consonants {
                grid-template-columns: repeat(7, 1fr);
            }
        }

        /* Landscape phone orientation */
        @media (max-height: 600px) and (orientation: landscape) {
            .container {
                padding: 10px;
            }

            .header {
                margin-bottom: 10px;
                padding-bottom: 10px;
            }

            h1 {
                font-size: 1.8rem;
            }

            .score-display {
                margin: 10px 0;
                padding: 8px;
            }

            .grid {
                margin: 10px 0;
                padding: 10px;
            }

            .cell {
                font-size: 1rem;
            }

            .modal-content {
                max-height: 90vh;
            }
        }

        /* Modal for consonant selection */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: #2d4d3d;
            border: 4px solid #6d5d45;
            border-radius: 8px;
            padding: 25px;
            max-width: 420px;
            width: 92%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.8);
            max-height: 85vh;
            overflow-y: auto;
        }

        .modal-content h2 {
            font-family: 'Permanent Marker', cursive;
            font-size: 1.8rem;
            color: #f4e4c1;
            text-align: center;
            margin-bottom: 20px;
        }

        .modal-content h3 {
            font-family: 'Permanent Marker', cursive;
            font-size: 1.3rem;
            color: #a8d5a8;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .modal-content p, .modal-content li {
            color: #c9b896;
            line-height: 1.8;
            margin-bottom: 10px;
        }

        .modal-content ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .modal-content kbd {
            background: rgba(0,0,0,0.3);
            padding: 3px 8px;
            border-radius: 3px;
            font-family: monospace;
            color: #a8d5a8;
            border: 1px solid rgba(168,213,168,0.3);
        }

        .modal-title {
            font-family: 'Permanent Marker', cursive;
            font-size: 1.5rem;
            color: #f4e4c1;
            text-align: center;
            margin-bottom: 20px;
        }

        .modal-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-bottom: 20px;
            width: 100%;
            box-sizing: border-box;
        }

        .modal-consonant-btn {
            padding: 15px;
            font-size: 1.2rem;
            font-family: 'Special Elite', cursive;
            background: #4a3a3a;
            color: #d5a8a8;
            border: 2px solid #5a4a4a;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            min-height: 48px;
            touch-action: manipulation;
            -webkit-touch-callout: none;
        }

        .modal-consonant-btn:hover:not(:disabled) {
            background: #5a4a4a;
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(90, 74, 74, 0.4);
        }

        .modal-consonant-btn:active:not(:disabled) {
            transform: scale(0.95);
            background: #6a5a5a;
        }

        .modal-consonant-btn:disabled {
            opacity: 0.2;
            cursor: not-allowed;
            background: #2a2a2a;
        }

        /* Intro Modal Styles */
        .intro-section {
            margin-bottom: 20px;
            text-align: left;
        }

        .intro-section h3 {
            color: #a8d5a8;
            font-size: 1rem;
            margin-bottom: 8px;
        }

        .intro-section p {
            color: #c9b896;
            font-size: 0.95rem;
            line-height: 1.5;
            margin: 5px 0;
        }

        .intro-method {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            background: rgba(90,125,90,0.15);
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .intro-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .intro-method strong {
            color: #f4e4c1;
        }

        .intro-detail {
            color: #a8b896;
            font-size: 0.9rem;
        }

        /* X close button for modals */
        .modal-x-close {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 32px;
            height: 32px;
            border: none;
            background: rgba(255,255,255,0.1);
            color: #a8b896;
            font-size: 1.2rem;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .modal-x-close:hover {
            background: rgba(255,255,255,0.2);
            color: #f4e4c1;
        }

        /* Tutorial step dots */
        .step-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }
        
        .step-dot.active {
            background: #f4e4c1;
            transform: scale(1.2);
        }
        
        .step-dot.completed {
            background: #a8d5a8;
        }

        /* Scroll indicator */
        .scroll-indicator {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #a8b896;
            font-size: 0.85rem;
            opacity: 0.8;
            pointer-events: none;
            animation: fadeInOut 2s ease-in-out infinite;
        }

        .scroll-indicator.hidden {
            display: none;
        }

        .scroll-arrow {
            font-size: 1.2rem;
            animation: bounceDown 1s ease-in-out infinite;
        }

        @keyframes bounceDown {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(5px); }
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .modal-consonant-btn.used {
            opacity: 0.3;
            cursor: not-allowed;
            background: #2a2a2a;
        }

        .clear-letter-btn {
            width: 100%;
            padding: 12px;
            margin-top: 15px;
            font-size: 1rem;
            font-family: 'Special Elite', cursive;
            background: rgba(122, 90, 90, 0.4);
            color: #d5a8a8;
            border: 2px solid rgba(122, 90, 90, 0.6);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .clear-letter-btn:hover {
            background: rgba(122, 90, 90, 0.6);
            border-color: rgba(122, 90, 90, 0.8);
        }

        .modal-close {
            width: 100%;
            padding: 12px;
            font-size: 0.9rem;
            background: #5a6a74;
            color: #fff;
            border: 2px solid #4a5a64;
            cursor: pointer;
        }

        .modal-close:hover {
            background: #6a7a84;
        }
        
        /* Standard Menu Section Styles */
        .setting-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 6px;
            margin-bottom: 15px;
        }
        
        .setting-row span {
            color: #f4e4c1;
        }
        
        .setting-row p {
            margin: 0;
        }
        
        .action-btn {
            width: 100%;
            padding: 12px;
            margin-top: 10px;
            margin-bottom: 15px;
            background: rgba(90,125,90,0.3);
            border: 1px solid rgba(90,125,90,0.5);
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            color: #f4e4c1;
            transition: all 0.2s;
        }
        
        .action-btn:hover {
            background: rgba(90,125,90,0.5);
        }
        
        .action-btn.primary {
            background: #5a7d5a;
            border-color: #5a7d5a;
        }
        
        .action-btn.primary:hover {
            background: #6a8d6a;
        }
        
        .action-btn.danger {
            background: rgba(122,90,90,0.3);
            border-color: rgba(122,90,90,0.5);
            color: #d5a8a8;
        }
        
        .action-btn.danger:hover {
            background: rgba(122,90,90,0.5);
        }
        
        .action-btn-small {
            padding: 6px 12px;
            margin-top: 8px;
            margin-bottom: 15px;
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            color: #a8b896;
            transition: all 0.2s;
        }
        
        .action-btn-small:hover {
            background: rgba(0,0,0,0.4);
            color: #f4e4c1;
        }
        
        details summary {
            cursor: pointer;
            padding: 5px 0;
        }
        
        details summary:hover {
            text-decoration: underline;
        }
        
        details[open] summary {
            margin-bottom: 8px;
        }
        
        /* Practice Mode Badge */
        .practice-badge {
            display: inline-block;
            padding: 2px 8px;
            background: #5a7d5a;
            color: #f4e4c1;
            font-size: 0.7rem;
            border-radius: 10px;
            margin-left: 5px;
            vertical-align: middle;
        }
        
        /* Date Picker Styles */
        .date-picker-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
        }
        
        .date-picker-month {
            font-size: 1.1rem;
            font-weight: 600;
            color: #f4e4c1;
        }
        
        .date-picker-nav {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px 10px;
            color: #a8d5a8;
            transition: all 0.2s;
        }
        
        .date-picker-nav:hover:not(:disabled) {
            color: #f4e4c1;
        }
        
        .date-picker-nav:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .date-picker-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 15px;
        }
        
        .date-picker-day-label {
            text-align: center;
            font-size: 0.75rem;
            font-weight: 600;
            color: #a8b896;
            padding: 5px;
        }
        
        .date-picker-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
            color: #f4e4c1;
        }
        
        .date-picker-day:hover:not(.disabled):not(.future) {
            background: rgba(90,125,90,0.3);
            border-color: #5a7d5a;
        }
        
        .date-picker-day.disabled {
            color: #666;
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .date-picker-day.future {
            color: #666;
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .date-picker-day.today {
            border-color: #a8d5a8;
            font-weight: bold;
        }
        
        .date-picker-day.won {
            background: #5a7d5a;
            color: #f4e4c1;
        }
        
        .date-picker-day.lost {
            background: #7a5a5a;
            color: #f4e4c1;
        }
        
        .date-picker-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
            font-size: 0.8rem;
            color: #a8b896;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .legend-dot.available {
            background: transparent;
            border: 1px solid #f4e4c1;
        }
        
        .legend-dot.won {
            background: #5a7d5a;
        }
        
        .legend-dot.lost {
            background: #7a5a5a;
        }
        
        .practice-stats-section {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .practice-stats-section h4 {
            text-align: center;
            margin-bottom: 10px;
            color: #f4e4c1;
        }
        
        .practice-stats-row {
            display: flex;
            justify-content: space-around;
            text-align: center;
        }
        
        .practice-stats-row .stat-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: #a8d5a8;
        }
        
        .practice-stats-row .stat-label {
            font-size: 0.7rem;
            color: #a8b896;
        }
        
        /* Account Section Styles */
        .account-section {
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
        }
        
        .account-signed-in .account-user-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .account-email {
            font-size: 0.85rem;
            font-weight: 500;
            color: #a8d5a8;
        }
        
        .account-sync {
            font-size: 0.75rem;
            color: #a8b896;
        }
        
        .account-actions {
            display: flex;
            gap: 8px;
        }
        
        .account-actions .action-btn-small {
            flex: 1;
        }
        
        .account-signed-out {
            text-align: center;
        }
        
        .account-signed-out.account-disabled {
            opacity: 0.7;
        }
        
        .action-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #3d4a3d;
            border-color: #5a6b5a;
            color: #888;
        }
        
        .action-btn.disabled:hover {
            transform: none;
            background: #3d4a3d;
        }
        
        /* Sync Indicator */
        .sync-indicator {
            position: absolute;
            top: 15px;
            right: 60px;
            padding: 6px 10px;
            background: rgba(255,255,255,0.1);
            border: 1px solid #5a6b5a;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            display: none;
        }
        
        .sync-indicator:hover {
            background: rgba(255,255,255,0.15);
        }
        
        .sync-indicator.syncing {
            animation: pulse 1s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Plain Mode Styles */
        body.plain-mode .practice-badge,
        body.plain-mode #practice-mode-section {
            display: none;
        }
    </style>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- RB Games Auth Module -->
    <script>
    const GSAuth = (function() {
        'use strict';
        
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyBQVwn8vOrFTzLlm2MYIPBwgZV2xR9AuhM",
            authDomain: "word-boxing.firebaseapp.com",
            databaseURL: "https://word-boxing-default-rtdb.firebaseio.com",
            projectId: "word-boxing",
            storageBucket: "word-boxing.firebasestorage.app",
            messagingSenderId: "300155036194",
            appId: "1:300155036194:web:b35463e6f9fbb04d7fe07b"
        };
        
        let currentUser = null;
        let gameId = null;
        let localKeys = {};
        let syncInProgress = false;
        let lastSyncTime = null;
        let isInitialized = false;
        
        function init(game, keys = {}) {
            if (isInitialized) return;
            gameId = game;
            localKeys = keys;
            
            if (typeof firebase !== 'undefined') {
                if (!firebase.apps.length) {
                    try {
                        firebase.initializeApp(FIREBASE_CONFIG);
                    } catch (e) {
                        console.error('Firebase init error:', e);
                        return;
                    }
                }
                firebase.auth().onAuthStateChanged(handleAuthStateChange);
                isInitialized = true;
            }
        }
        
        function handleAuthStateChange(user) {
            const wasSignedIn = !!currentUser;
            currentUser = user;
            const isPlainModeOn = typeof plainMode !== 'undefined' ? plainMode : false;
            
            if (isPlainModeOn && user) {
                firebase.auth().signOut();
                return;
            }
            
            if (user && !wasSignedIn && !isPlainModeOn) {
                saveProfile();
                updateSyncIndicator('syncing');
                sync().then(() => {
                    updateUI();
                    updateSyncIndicator('synced');
                });
            } else {
                updateUI();
                if (!isPlainModeOn) {
                    updateSyncIndicator(user ? 'synced' : 'hidden');
                } else {
                    updateSyncIndicator('hidden');
                }
            }
        }
        
        async function signIn() {
            const isPlainModeOn = typeof plainMode !== 'undefined' ? plainMode : false;
            if (isPlainModeOn) return null;
            
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                const result = await firebase.auth().signInWithPopup(provider);
                return result.user;
            } catch (error) {
                console.error('Sign in error:', error);
                if (error.code === 'auth/popup-blocked') {
                    alert('Popup was blocked. Please allow popups for this site.');
                } else if (error.code === 'auth/unauthorized-domain') {
                    alert('This domain is not authorized. Add it in Firebase Console.');
                } else {
                    alert('Sign in failed: ' + error.message);
                }
                return null;
            }
        }
        
        async function signOut() {
            if (currentUser) await firebase.auth().signOut();
        }
        
        function isSignedIn() { return !!currentUser; }
        
        function getGameRef() {
            if (!currentUser || !gameId) return null;
            return firebase.database().ref(`users/${currentUser.uid}/games/${gameId}`);
        }
        
        async function saveProfile() {
            if (!currentUser) return;
            try {
                await firebase.database().ref(`users/${currentUser.uid}`).update({
                    email: currentUser.email,
                    displayName: currentUser.displayName || '',
                    lastSeen: firebase.database.ServerValue.TIMESTAMP
                });
            } catch (e) {}
        }
        
        async function saveToCloud(data) {
            const ref = getGameRef();
            if (!ref) return false;
            try {
                await ref.update({ ...data, lastSync: firebase.database.ServerValue.TIMESTAMP });
                lastSyncTime = new Date();
                return true;
            } catch (e) { return false; }
        }
        
        async function loadFromCloud() {
            const ref = getGameRef();
            if (!ref) return null;
            try {
                const snapshot = await ref.once('value');
                return snapshot.exists() ? snapshot.val() : null;
            } catch (e) { return null; }
        }
        
        function getLocalData() {
            const data = {};
            for (const [key, storageKey] of Object.entries(localKeys)) {
                try {
                    const raw = localStorage.getItem(storageKey);
                    if (raw) data[key] = JSON.parse(raw);
                } catch (e) {}
            }
            return data;
        }
        
        function saveLocalData(data) {
            for (const [key, storageKey] of Object.entries(localKeys)) {
                if (data[key] !== undefined) {
                    try { localStorage.setItem(storageKey, JSON.stringify(data[key])); } catch (e) {}
                }
            }
        }
        
        function mergeData(local, cloud) {
            const merged = {};
            if (local.stats || cloud.stats) {
                const ls = local.stats || {};
                const cs = cloud.stats || {};
                merged.stats = {
                    gamesPlayed: Math.max(ls.gamesPlayed || 0, cs.gamesPlayed || 0),
                    gamesWon: Math.max(ls.gamesWon || 0, cs.gamesWon || 0),
                    totalScore: Math.max(ls.totalScore || 0, cs.totalScore || 0),
                    bestScore: Math.min(ls.bestScore || 999, cs.bestScore || 999),
                    currentStreak: (ls.lastPlayedDate > cs.lastPlayedDate) ? (ls.currentStreak || 0) : (cs.currentStreak || 0),
                    maxStreak: Math.max(ls.maxStreak || 0, cs.maxStreak || 0),
                    lastPlayedDate: ls.lastPlayedDate > cs.lastPlayedDate ? ls.lastPlayedDate : cs.lastPlayedDate
                };
            }
            if (local.practice || cloud.practice) {
                const lp = local.practice || {};
                const cp = cloud.practice || {};
                merged.practice = {
                    played: Math.max(lp.played || 0, cp.played || 0),
                    won: Math.max(lp.won || 0, cp.won || 0),
                    history: { ...(lp.history || {}), ...(cp.history || {}) }
                };
            }
            return merged;
        }
        
        async function sync() {
            if (!currentUser || syncInProgress) return null;
            syncInProgress = true;
            
            try {
                const cloudData = await loadFromCloud();
                const localData = getLocalData();
                
                if (!cloudData || Object.keys(cloudData).length === 0) {
                    await saveToCloud(localData);
                    lastSyncTime = new Date();
                    return localData;
                }
                
                const merged = mergeData(localData, cloudData);
                saveLocalData(merged);
                await saveToCloud(merged);
                lastSyncTime = new Date();
                return merged;
            } catch (e) {
                return null;
            } finally {
                syncInProgress = false;
            }
        }
        
        function updateUI() {
            const section = document.getElementById('account-section');
            if (!section) return;
            
            const isPlainModeOn = typeof plainMode !== 'undefined' ? plainMode : false;
            
            if (currentUser) {
                section.innerHTML = `
                    <div class="account-signed-in">
                        <div class="account-user-row">
                            <span class="account-email">${currentUser.email}</span>
                            <span class="account-sync" id="sync-status">${getSyncStatusText()}</span>
                        </div>
                        <div class="account-actions">
                            <button type="button" class="action-btn-small" onclick="GSAuth.sync()">‚Üª Sync</button>
                            <button type="button" class="action-btn-small" onclick="GSAuth.signOut()">Sign Out</button>
                        </div>
                    </div>
                `;
            } else if (isPlainModeOn) {
                section.innerHTML = `
                    <div class="account-signed-out account-disabled">
                        <p style="font-size: 0.85rem; color: #a8b896; margin-bottom: 10px;">Cloud sync & extra features</p>
                        <button type="button" class="action-btn disabled" disabled>üîí Sign in with Google</button>
                        <p style="font-size: 0.75rem; color: #888; margin-top: 8px;">Turn off Plain Mode to enable</p>
                    </div>
                `;
            } else {
                section.innerHTML = `
                    <div class="account-signed-out">
                        <p style="font-size: 0.85rem; color: #a8b896; margin-bottom: 10px;">Save progress across devices</p>
                        <button type="button" class="action-btn" onclick="GSAuth.signIn()">üîê Sign in with Google</button>
                    </div>
                `;
            }
        }
        
        function getSyncStatusText() {
            if (!lastSyncTime) return '&#9729; Not synced';
            const diff = Math.floor((new Date() - lastSyncTime) / 1000);
            if (diff < 60) return '&#9729; Just synced';
            if (diff < 3600) return `&#9729; ${Math.floor(diff / 60)}m ago`;
            return `&#9729; ${Math.floor(diff / 3600)}h ago`;
        }
        
        function updateSyncIndicator(status) {
            const indicator = document.getElementById('sync-indicator');
            if (!indicator) return;
            
            const isPlainModeOn = typeof plainMode !== 'undefined' ? plainMode : false;
            if (isPlainModeOn) {
                indicator.style.display = 'none';
                return;
            }
            
            indicator.classList.remove('syncing');
            switch (status) {
                case 'hidden': indicator.style.display = 'none'; break;
                case 'syncing':
                    indicator.style.display = 'block';
                    indicator.classList.add('syncing');
                    indicator.textContent = 'üîÑ';
                    break;
                case 'synced':
                    indicator.style.display = 'block';
                    indicator.innerHTML = '&#9729;';
                    break;
            }
        }
        
        return {
            init, signIn, signOut, isSignedIn, sync, updateUI,
            get currentUser() { return currentUser; }
        };
    })();
    </script>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="https://gameshelf.co/" class="back-button" aria-label="Back to Game Shelf">‚Üê <span class="back-text">Game Shelf</span></a>
            <button class="menu-button" onclick="openMenu()" aria-label="Menu">&#9776;</button>
            <div class="sync-indicator" id="sync-indicator" onclick="openMenu()" title="Cloud sync status">&#9729;</div>
            <h1>SLATE</h1>
            <div class="subtitle">Daily Word Challenge</div>
        </div>

        <div class="score-display">
            Score: <strong id="score">0</strong> |
            Consonants Used: <strong id="consonants-count">0</strong> |
            Words Found: <strong id="words-found">0</strong>/8
        </div>

        <div class="grid" id="grid"></div>

        <div class="message" id="message"></div>

        <div class="controls">
            <div class="consonants" id="consonants"></div>
        </div>

        <div id="game-over" style="display: none;"></div>
    </div>

    <!-- Intro/Tutorial Modal -->
    <!-- Tutorial Choice Modal (first-time players) -->
    <div class="modal-overlay" id="tutorial-choice-modal">
        <div class="modal-content" style="max-width: 420px;">
            <h2 style="color: #f4e4c1; margin-bottom: 15px;">üëã Welcome to Slate!</h2>
            
            <div style="text-align: left; color: #c9b896;">
                <p>Fill in consonants to reveal 8 hidden words. <strong>Lowest score wins!</strong></p>
                
                <p style="margin-top: 15px;">Is this your first time playing?</p>
            </div>
            
            <div style="margin-top: 25px; display: flex; flex-direction: column; gap: 12px;">
                <button class="modal-close" onclick="startTutorial()" style="width: 100%; padding: 15px; background: #5a7d5a;">
                    üéì Yes, show me how to play<br>
                    <span style="font-size: 0.8rem; opacity: 0.8;">(Quick walkthrough)</span>
                </button>
                
                <button class="modal-close" onclick="skipTutorial()" style="width: 100%; padding: 15px; background: #4a5d4a;">
                    üöÄ I know the rules, let's go!<br>
                    <span style="font-size: 0.8rem; opacity: 0.8;">(Start today's puzzle)</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Tutorial Walkthrough Modal (step-by-step guide) -->
    <div class="modal-overlay" id="tutorial-walkthrough-modal">
        <div class="modal-content" style="max-width: 450px; position: relative;">
            <button class="modal-x-close" onclick="exitTutorialWalkthrough()">‚úï</button>
            
            <!-- Step indicator -->
            <div id="tutorial-step-indicator" style="display: flex; justify-content: center; gap: 8px; margin-bottom: 20px;">
                <span class="step-dot active"></span>
                <span class="step-dot"></span>
                <span class="step-dot"></span>
                <span class="step-dot"></span>
            </div>
            
            <!-- Step 1: The Grid -->
            <div class="tutorial-step" id="tutorial-step-1">
                <h2 style="color: #f4e4c1; margin-bottom: 15px;">Step 1: The Grid</h2>
                <div style="text-align: left; color: #c9b896;">
                    <div style="background: rgba(90,125,90,0.3); padding: 15px; border-radius: 12px; margin-bottom: 15px;">
                        <div style="display: flex; justify-content: center; gap: 4px; margin-bottom: 8px;">
                            <span style="background: #a8d5a8; color: #1a3a2a; padding: 8px 12px; border-radius: 4px; font-weight: bold;">A</span>
                            <span style="background: #5a7d5a; color: #f4e4c1; padding: 8px 12px; border-radius: 4px;">_</span>
                            <span style="background: #5a7d5a; color: #f4e4c1; padding: 8px 12px; border-radius: 4px;">_</span>
                            <span style="background: #a8d5a8; color: #1a3a2a; padding: 8px 12px; border-radius: 4px; font-weight: bold;">E</span>
                            <span style="background: #5a7d5a; color: #f4e4c1; padding: 8px 12px; border-radius: 4px;">_</span>
                        </div>
                        <div style="text-align: center; font-size: 0.85rem; color: #a8b896;">A _ _ E _ ‚Üí AGENT?</div>
                    </div>
                    <p>You'll see 8 words with <strong style="color: #a8d5a8;">vowels already filled in</strong> (green squares).</p>
                    <p style="margin-top: 10px;">Your job: figure out each word by filling in the <strong>blank consonant squares</strong>.</p>
                </div>
            </div>
            
            <!-- Step 2: Two Ways to Fill -->
            <div class="tutorial-step" id="tutorial-step-2" style="display: none;">
                <h2 style="color: #f4e4c1; margin-bottom: 15px;">Step 2: Filling In Blanks</h2>
                <div style="text-align: left; color: #c9b896;">
                    <p style="margin-bottom: 12px;"><strong>Click any blank square</strong> to open the consonant picker:</p>
                    <div style="background: rgba(90,125,90,0.3); padding: 15px; border-radius: 12px; margin-bottom: 15px;">
                        <!-- Visual: blank square being clicked -->
                        <div style="display: flex; justify-content: center; gap: 4px; margin-bottom: 12px;">
                            <span style="background: #a8d5a8; color: #1a3a2a; padding: 8px 12px; border-radius: 4px; font-weight: bold;">A</span>
                            <span style="background: #f4e4c1; color: #1a3a2a; padding: 8px 12px; border-radius: 4px; border: 2px solid #fff;">_</span>
                            <span style="background: #5a7d5a; color: #f4e4c1; padding: 8px 12px; border-radius: 4px;">_</span>
                            <span style="background: #a8d5a8; color: #1a3a2a; padding: 8px 12px; border-radius: 4px; font-weight: bold;">E</span>
                            <span style="background: #5a7d5a; color: #f4e4c1; padding: 8px 12px; border-radius: 4px;">_</span>
                        </div>
                        <!-- Visual: consonant picker modal -->
                        <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 0.8rem; color: #a8b896; margin-bottom: 8px;">Select a consonant:</div>
                            <div style="display: flex; flex-wrap: wrap; gap: 4px; justify-content: center;">
                                <span style="background: #5a7d5a; padding: 6px 10px; border-radius: 4px; font-size: 0.9rem;">B</span>
                                <span style="background: #5a7d5a; padding: 6px 10px; border-radius: 4px; font-size: 0.9rem;">C</span>
                                <span style="background: #5a7d5a; padding: 6px 10px; border-radius: 4px; font-size: 0.9rem;">D</span>
                                <span style="background: #7a9d7a; padding: 6px 10px; border-radius: 4px; font-size: 0.9rem; border: 2px solid #a8d5a8;">G</span>
                                <span style="background: #5a7d5a; padding: 6px 10px; border-radius: 4px; font-size: 0.9rem;">...</span>
                            </div>
                        </div>
                    </div>
                    <p style="color: #a8d5a8;">‚úì Filling squares this way is <strong>FREE</strong> ‚Äî no points added!</p>
                    <p style="margin-top: 10px; color: #a8d5a8;">‚úì <strong>Solve a word correctly</strong> and its consonants appear FREE in all other words!</p>
                    <p style="margin-top: 10px; color: #d5a8a8;">‚úó <strong>Wrong guess?</strong> Your consonant score goes up by 1.</p>
                    <p style="margin-top: 12px; padding: 10px; background: rgba(90,90,90,0.3); border-radius: 8px;">
                        <strong>Alternatively</strong>, if you need help, select a consonant from the keyboard at the bottom. Each consonant selected adds <strong>+1 to your consonant score</strong>. Remember: your goal is the lowest total score ‚Äî a higher consonant score quickly adds up!
                    </p>
                </div>
            </div>
            
            <!-- Step 3: Scoring -->
            <div class="tutorial-step" id="tutorial-step-3" style="display: none;">
                <h2 style="color: #f4e4c1; margin-bottom: 15px;">Step 3: Scoring</h2>
                <div style="text-align: left; color: #c9b896;">
                    <!-- Visual: Score banner mockup -->
                    <div style="background: rgba(90,125,90,0.3); padding: 15px; border-radius: 12px; margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-around; text-align: center;">
                            <div>
                                <div style="font-size: 0.75rem; color: #a8b896;">SCORE</div>
                                <div style="font-size: 1.5rem; font-weight: bold; color: #f4e4c1;">12</div>
                            </div>
                            <div>
                                <div style="font-size: 0.75rem; color: #a8b896;">WORDS</div>
                                <div style="font-size: 1.5rem; font-weight: bold; color: #a8d5a8;">3/8</div>
                            </div>
                            <div>
                                <div style="font-size: 0.75rem; color: #a8b896;">CONSONANTS</div>
                                <div style="font-size: 1.5rem; font-weight: bold; color: #d5a8a8;">5</div>
                            </div>
                        </div>
                    </div>
                    <p><strong style="color: #f4e4c1;">Total Score</strong> = sum of all word scores</p>
                    <p style="margin-top: 8px;"><strong style="color: #a8d5a8;">Word Score</strong> = consonant score when that word is solved</p>
                    <p style="margin-top: 8px;"><strong style="color: #d5a8a8;">Consonant Score</strong> = consonants used from keyboard + wrong word guesses</p>
                    <p style="margin-top: 12px; padding: 10px; background: rgba(125,90,90,0.3); border-radius: 8px;">
                        <strong>‚ö†Ô∏è Game Over</strong> if total score exceeds <strong>50 points</strong>, or if it becomes impossible to stay under 50.
                    </p>
                    <p style="margin-top: 12px; padding: 10px; background: rgba(90,90,90,0.3); border-radius: 8px;">
                        <strong>Hard Mode:</strong> Consonants from solved words are NOT revealed in other words ‚Äî every consonant counts!
                    </p>
                </div>
            </div>
            
            <!-- Step 4: Strategy -->
            <div class="tutorial-step" id="tutorial-step-4" style="display: none;">
                <h2 style="color: #f4e4c1; margin-bottom: 15px;">Step 4: Strategy</h2>
                <div style="text-align: left; color: #c9b896;">
                    <div style="background: rgba(90,125,90,0.3); padding: 15px; border-radius: 12px; margin-bottom: 15px; text-align: center;">
                        <div style="font-size: 2rem; margin-bottom: 10px;">üèÜ</div>
                        <div style="color: #a8d5a8; font-weight: bold;">All 8 words complete!</div>
                        <div style="margin-top: 8px;">Final Score: <strong style="color: #f4e4c1; font-size: 1.2rem;">12</strong></div>
                        <div style="margin-top: 5px; font-size: 0.9rem;">‚≠ê‚≠ê‚≠ê</div>
                    </div>
                    <p><strong>Lower score = better!</strong> Complete all 8 words to win.</p>
                    <p style="margin-top: 12px;">üí° <strong>Pro tips:</strong></p>
                    <ul style="margin-left: 20px; margin-top: 8px;">
                        <li>Solve easy words first ‚Äî their consonants help reveal others FREE</li>
                        <li>Each word you complete early locks in a lower score</li>
                        <li>Score 0? That's a <strong style="color: #f4e4c1;">perfect game!</strong> üèÜ</li>
                    </ul>
                </div>
            </div>
            
            <!-- Navigation buttons -->
            <div style="margin-top: 25px; display: flex; gap: 12px;">
                <button class="modal-close" id="tutorial-prev-btn" onclick="prevTutorialStep()" style="flex: 1; background: #4a5d4a; display: none;">‚Üê Back</button>
                <button class="modal-close" id="tutorial-next-btn" onclick="nextTutorialStep()" style="flex: 1; background: #5a7d5a;">Next ‚Üí</button>
            </div>
            <button class="modal-close" onclick="exitTutorialWalkthrough()" style="width: 100%; margin-top: 10px; background: transparent; color: #a8b896; border: none;">Skip tutorial</button>
        </div>
    </div>

    <div class="modal-overlay" id="intro-modal">
        <div class="modal-content" style="max-width: 450px; position: relative;">
            <button class="modal-x-close" onclick="closeIntro()">‚úï</button>
            <h2 style="color: #f4e4c1; margin-bottom: 20px;">üéì Welcome to Slate!</h2>
            
            <div class="intro-section">
                <h3>üéØ Goal</h3>
                <p>Figure out all <strong>8 five-letter words</strong> by filling in the missing consonants. <strong>Lowest score wins!</strong></p>
            </div>
            
            <div class="intro-section">
                <h3>üìù The Grid</h3>
                <p>You'll see 8 words with <strong style="color: #a8d5a8;">vowels already filled in</strong>. Figure out what the words are by filling in the <strong style="color: #d5a8a8;">consonants</strong>.</p>
            </div>
            
            <div class="intro-section">
                <h3>üî§ Two Ways to Fill In Consonants</h3>
                <div class="intro-method">
                    <span class="intro-icon">üëÜ</span>
                    <div>
                        <strong>Click a blank square</strong><br>
                        <span class="intro-detail">Select a consonant for that spot ‚Äî <strong style="color: #a8d5a8;">FREE!</strong> No points added.</span>
                    </div>
                </div>
                <div class="intro-method">
                    <span class="intro-icon">üîò</span>
                    <div>
                        <strong>Click a consonant button (bottom)</strong><br>
                        <span class="intro-detail">Reveals that letter <em>everywhere</em> ‚Äî <strong style="color: #d5a8a8;">+1 point</strong> (use as a hint!)</span>
                    </div>
                </div>
            </div>
            
            <div class="intro-section">
                <h3>‚≠ê Scoring</h3>
                <p>When you complete a word, it scores the <strong>current consonant count</strong>. Solve words early before the count rises!</p>
                <p style="color: #d5a8a8; font-size: 0.9rem; margin-top: 8px;">‚ö†Ô∏è Wrong word guess = +1 penalty</p>
                <p style="color: #d5a8a8; font-size: 0.9rem;">‚ö†Ô∏è Point limit: 50 (game over if exceeded)</p>
            </div>
            
            <div style="margin-top: 25px; padding-top: 15px; border-top: 1px solid #5a7d5a;">
                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; color: #a8b896;">
                    <input type="checkbox" id="skip-intro-checkbox" style="width: 18px; height: 18px; cursor: pointer;">
                    <span>Don't show this again</span>
                </label>
            </div>
            
            <button class="modal-close" onclick="closeIntro()" style="margin-top: 20px; background: #5a7d5a; font-size: 1.1rem; padding: 15px 40px;">Let's Play! üéÆ</button>
            
            <div class="scroll-indicator" id="intro-scroll-indicator">
                <span>Scroll for more</span>
                <div class="scroll-arrow">‚Üì</div>
            </div>
        </div>
    </div>

    <!-- Consonant Selection Modal -->
    <div class="modal-overlay" id="consonant-modal">
        <div class="modal-content">
            <div class="modal-title">Select a Consonant</div>
            <div id="selected-square-info" style="background: rgba(90,125,90,0.3); padding: 10px 15px; border-radius: 6px; margin-bottom: 15px; font-size: 1.1rem; color: #a8d5a8;">
                Filling: <strong id="selected-square-label">Row ? Col ?</strong>
            </div>
            <div class="modal-grid" id="modal-consonants"></div>
            <button id="clear-letter-btn" class="clear-letter-btn" onclick="clearSelectedSquare()" style="display: none;">üóëÔ∏è Clear Letter</button>
            <div class="keyboard-tip" style="margin-top: 15px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 6px; font-size: 0.9rem; color: #c9b896;">
                ‚å®Ô∏è <strong>Tip:</strong> Type a letter to select it quickly! Press <strong>Backspace</strong> to clear.
            </div>
            <button class="modal-close" onclick="closeModal()">Cancel</button>
        </div>
    </div>

    <!-- Consonant Confirmation Modal -->
    <div class="modal-overlay" id="confirm-modal">
        <div class="modal-content" style="max-width: 350px; text-align: center;">
            <div class="modal-title">‚ö†Ô∏è Confirm Global Reveal</div>
            <div style="margin: 20px 0;">
                <div style="font-size: 4rem; margin: 15px 0;" id="confirm-letter">?</div>
                <p style="color: #c9b896; font-size: 1.1rem;">Reveal <strong id="confirm-letter-text">?</strong> everywhere?</p>
                <p style="color: #d5a8a8; font-size: 0.95rem;">This will cost <strong>+1 point</strong></p>
            </div>
            <div style="display: flex; gap: 15px; justify-content: center; margin-top: 20px;">
                <button onclick="confirmConsonantReveal()" style="background: #5a7d5a; padding: 12px 30px;">Yes, Reveal</button>
                <button onclick="cancelConsonantReveal()" style="background: #7a5a5a; padding: 12px 30px;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Menu Modal -->
    <div class="modal-overlay" id="menu-modal">
        <div class="modal-content">
            <button class="modal-x-close" onclick="closeMenu()">‚úï</button>
            <h2>üìã Menu</h2>
            
            <!-- 0. ACCOUNT -->
            <h3>&#9729; Account</h3>
            <div id="account-section" class="account-section">
                <div class="account-signed-out account-disabled">
                    <p style="font-size: 0.85rem; color: #a8b896; margin-bottom: 10px;">Cloud sync & extra features</p>
                    <button type="button" class="action-btn disabled" disabled>üîí Sign in with Google</button>
                    <p style="font-size: 0.75rem; color: #888; margin-top: 8px;">Turn off Plain Mode to enable</p>
                </div>
            </div>
            
            <!-- 1. DIFFICULTY -->
            <h3>&#9881; Difficulty</h3>
            <div class="difficulty-toggle" id="difficulty-toggle" style="margin-bottom: 15px;">
                <button class="difficulty-btn active" id="easy-btn" onclick="setDifficulty('easy')">üü¢ Easy</button>
                <button class="difficulty-btn" id="hard-btn" onclick="setDifficulty('hard')">üî¥ Hard</button>
            </div>
            <p style="font-size: 0.85rem; color: #a8b896; margin-top: -5px; margin-bottom: 20px;">
                <strong>Easy:</strong> Solved word consonants revealed in other words.<br>
                <strong>Hard:</strong> No free reveals. Every consonant counts!
            </p>
            
            <!-- 2. SOUND -->
            <h3>üîä Sound</h3>
            <div class="setting-row">
                <span>Sound Effects</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="sound-toggle" onchange="toggleSound()" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>
            <button onclick="testSounds()" class="action-btn-small">üîä Test Sounds</button>
            
            <!-- 3. TUTORIAL -->
            <h3>üìñ Tutorial</h3>
            <div class="setting-row">
                <span>Show on First Visit</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="show-intro-toggle" onchange="toggleShowIntro()" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>
            <button class="action-btn" onclick="replayTutorial()">üéì Replay Tutorial</button>
            
            <!-- 4. PRACTICE MODE -->
            <h3>üìÖ Practice Mode</h3>
            <p style="font-size: 0.85rem; color: #a8b896; margin-bottom: 10px;">Play any past puzzle! Stats tracked separately.</p>
            <button class="action-btn primary" onclick="openPracticeModal()">Browse Past Puzzles</button>
            
            <!-- 5. SETTINGS -->
            <h3>&#9881; Settings</h3>
            <div class="setting-row">
                <div>
                    <span>Confirm Global Reveals</span>
                    <p style="font-size: 0.8rem; color: #888; margin: 2px 0 0 0;">Ask before revealing consonants (+1 pt)</p>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="confirm-toggle" onchange="toggleConfirmation()" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>
            
            <!-- 5.5. PLAIN MODE -->
            <h3>üìã Plain Mode</h3>
            <div class="setting-row">
                <div>
                    <span>Plain Mode</span>
                    <p style="font-size: 0.8rem; color: #888; margin: 2px 0 0 0;">Simplified experience (Free tier)</p>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="plain-mode-toggle" onchange="togglePlainMode()" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>
            
            <!-- 6. HOW TO PLAY -->
            <h3>‚ùì How to Play</h3>
            <p>Figure out all 8 five-letter words by filling in the missing consonants. <strong>Lowest score wins!</strong></p>
            <p style="margin-top: 8px;"><strong>Two ways to fill consonants:</strong></p>
            <ul>
                <li><strong>Click a square</strong> ‚Üí Select a consonant (FREE!)</li>
                <li><strong>Click consonant button</strong> ‚Üí Reveal everywhere (+1 point)</li>
            </ul>
            
            <details style="margin-top: 10px;">
                <summary style="cursor: pointer; color: #a8d5a8;">‚å®Ô∏è Keyboard Shortcuts</summary>
                <ul style="margin-top: 8px;">
                    <li><kbd>A-Z</kbd> - Type consonant when modal open</li>
                    <li><kbd>ESC</kbd> - Close any modal</li>
                </ul>
            </details>
            
            <!-- 7. GAME INFO -->
            <h3>‚ÑπÔ∏è Game Info</h3>
            <p><strong>Puzzle:</strong> <span id="puzzle-date">Daily</span></p>
            <p><strong>Version:</strong> v1.0.16</p>
            <p style="font-size: 0.85rem; color: #a8b896; margin-top: 8px;">A daily word puzzle game. New words every day at midnight!</p>
            
            <!-- 8. DATA -->
            <h3>üóëÔ∏è Data</h3>
            <button class="action-btn danger" onclick="resetStatistics()">Reset Statistics</button>
            
            <!-- Game Shelf Badge -->
            <div style="text-align: center; padding: 20px 15px; background: linear-gradient(135deg, rgba(102,126,234,0.15) 0%, rgba(118,75,162,0.15) 100%); border-radius: 12px; margin-top: 20px;">
                <div style="display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 10px;">
                    <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" style="width: 40px; height: 40px;">
                        <defs>
                            <linearGradient id="gsBadgeGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#667eea"/>
                                <stop offset="100%" style="stop-color:#764ba2"/>
                            </linearGradient>
                        </defs>
                        <rect x="5" y="5" width="90" height="90" rx="20" fill="url(#gsBadgeGrad)"/>
                        <g transform="rotate(-12, 35, 50)">
                            <rect x="15" y="28" width="28" height="36" rx="4" fill="white"/>
                            <circle cx="43" cy="46" r="6" fill="white"/>
                            <text x="29" y="54" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#667eea" text-anchor="middle">G</text>
                        </g>
                        <g transform="rotate(12, 65, 50)">
                            <rect x="57" y="28" width="28" height="36" rx="4" fill="rgba(255,255,255,0.9)"/>
                            <circle cx="57" cy="46" r="6" fill="url(#gsBadgeGrad)"/>
                            <text x="71" y="54" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#764ba2" text-anchor="middle">S</text>
                        </g>
                    </svg>
                    <span style="font-size: 1.1rem; font-weight: 600; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">A Game Shelf Original</span>
                </div>
                <p style="font-size: 0.85rem; color: #a8b896; margin: 0;">
                    Track your daily puzzles at <a href="https://gameshelf.club" target="_blank" style="color: #667eea; text-decoration: none; font-weight: 500;">gameshelf.club</a>
                </p>
            </div>
            
            <button class="modal-close" onclick="closeMenu()" style="margin-top: 25px;">Close</button>
        </div>
    </div>
    
    <!-- Practice Mode Modal -->
    <div class="modal-overlay" id="practice-modal">
        <div class="modal-content" style="max-width: 420px;">
            <button class="modal-x-close" onclick="closePracticeModal()">‚úï</button>
            <h2>üìÖ Practice Mode</h2>
            <p style="text-align: center; color: #a8b896; margin-bottom: 15px;">Select a past puzzle to play</p>
            
            <!-- Month Navigation -->
            <div class="date-picker-header">
                <button class="date-picker-nav" id="prev-month" onclick="changeMonth(-1)">‚óÄ</button>
                <span class="date-picker-month" id="current-month">January 2026</span>
                <button class="date-picker-nav" id="next-month" onclick="changeMonth(1)">‚ñ∂</button>
            </div>
            
            <!-- Calendar Grid -->
            <div class="date-picker-grid" id="date-picker-grid">
                <div class="date-picker-day-label">Sun</div>
                <div class="date-picker-day-label">Mon</div>
                <div class="date-picker-day-label">Tue</div>
                <div class="date-picker-day-label">Wed</div>
                <div class="date-picker-day-label">Thu</div>
                <div class="date-picker-day-label">Fri</div>
                <div class="date-picker-day-label">Sat</div>
            </div>
            
            <!-- Legend -->
            <div class="date-picker-legend">
                <div class="legend-item">
                    <div class="legend-dot available"></div>
                    <span>Available</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot won"></div>
                    <span>Won</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot lost"></div>
                    <span>Lost</span>
                </div>
            </div>
            
            <!-- Practice Stats -->
            <div class="practice-stats-section">
                <h4>Practice Stats</h4>
                <div class="practice-stats-row">
                    <div class="stat">
                        <div class="stat-value" id="practice-played">0</div>
                        <div class="stat-label">Played</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="practice-won">0</div>
                        <div class="stat-label">Won</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="practice-rate">0%</div>
                        <div class="stat-label">Win Rate</div>
                    </div>
                </div>
            </div>
            
            <button class="modal-close" onclick="returnToDaily()" style="background: #4a5d4a;">Return to Daily Puzzle</button>
        </div>
    </div>

    <script>
        // ============ GAME SHELF INTEGRATION MODULE v1.0.16 ============
        (function() {
            'use strict';
            const GAMESHELF_VERSION = '1.0.16';
            if (window.GameShelfIntegration) return;
            
            window.GameShelfIntegration = {
                version: GAMESHELF_VERSION,
                gameId: null,
                gameConfig: null,
                _initialized: false,
                
                init: function(gameId, config) {
                    if (this._initialized) return;
                    this.gameId = gameId;
                    this.gameConfig = {
                        name: config.name || gameId,
                        icon: config.icon || 'üéÆ',
                        url: config.url || window.location.hostname,
                        version: config.version || '1.0.16',
                        type: config.type || 'daily',
                        ...config
                    };
                    this._initialized = true;
                    this._announcePresence();
                    console.log(`üéÆ Game Shelf Integration initialized for ${this.gameConfig.name}`);
                },
                
                reportComplete: function(result) {
                    if (!this._initialized) return null;
                    const payload = this._buildPayload(result);
                    // Removed: this._storeResult(payload) - copy/paste is now standard
                    this._dispatchEvents(payload);
                    return payload;
                },
                
                _buildPayload: function(result) {
                    return {
                        gameId: this.gameId,
                        gameName: this.gameConfig.name,
                        gameIcon: this.gameConfig.icon,
                        gameUrl: this.gameConfig.url,
                        gameVersion: this.gameConfig.version,
                        timestamp: new Date().toISOString(),
                        date: this._getTodayString(),
                        puzzleId: result.puzzleId || this._getTodayString(),
                        puzzleNumber: result.puzzleNumber || null,
                        result: {
                            won: !!result.won,
                            score: result.score ?? null,
                            attempts: result.attempts ?? null,
                            maxAttempts: result.maxAttempts ?? null,
                            hintsUsed: result.hintsUsed ?? 0,
                            gaveUp: !!result.gaveUp,
                            perfect: !!result.perfect
                        },
                        streak: result.streak || null,
                        meta: {
                            difficulty: result.difficulty ?? null,
                            mode: result.mode ?? null,
                            category: result.category ?? null,
                            ...(result.meta || {})
                        },
                        grid: result.grid || null,
                        scoreLine: result.scoreLine || null,
                        shareText: result.shareText || null
                    };
                },
                
                _announcePresence: function() {
                    document.documentElement.setAttribute('data-gameshelf-game', this.gameId);
                    document.documentElement.setAttribute('data-gameshelf-version', GAMESHELF_VERSION);
                    window.dispatchEvent(new CustomEvent('gameshelf:presence', {
                        detail: { gameId: this.gameId, config: this.gameConfig }
                    }));
                },
                
                _dispatchEvents: function(payload) {
                    window.dispatchEvent(new CustomEvent('gameshelf:complete', { detail: payload }));
                    window.dispatchEvent(new CustomEvent('gameshelf:gameComplete', { detail: payload }));
                },
                
                _storeResult: function(payload) {
                    try {
                        localStorage.setItem(`gameshelf_${this.gameId}_latest`, JSON.stringify(payload));
                        let history = JSON.parse(localStorage.getItem(`gameshelf_${this.gameId}_history`) || '[]');
                        history = history.filter(h => h.puzzleId !== payload.puzzleId);
                        history.unshift(payload);
                        localStorage.setItem(`gameshelf_${this.gameId}_history`, JSON.stringify(history.slice(0, 30)));
                    } catch (e) {}
                },
                
                _getTodayString: function() {
                    const d = new Date();
                    return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
                }
            };
        })();
        // ============ END GAME SHELF INTEGRATION ============

        // Word database: 2000 five-letter words
        const WORD_DATABASE = [
            'ABBEY', 'ABIDE', 'ABORT', 'ABOUT', 'ABOVE', 'ABUSE', 'ACTOR', 'ACUTE', 'ADMIT', 'ADOPT',
            'ADULT', 'AFTER', 'AGAIN', 'AGENT', 'AGREE', 'AHEAD', 'ALARM', 'ALBUM', 'ALERT', 'ALIEN',
            'ALIGN', 'ALIKE', 'ALIVE', 'ALLOW', 'ALONE', 'ALONG', 'ALTER', 'ANGEL', 'ANGER', 'ANGLE',
            'ANGRY', 'APART', 'APPLE', 'APPLY', 'APRIL', 'ARENA', 'ARGUE', 'ARISE', 'ARMED', 'ARMOR',
            'ARRAY', 'ARROW', 'ASIDE', 'ASSET', 'AVOID', 'AWAKE', 'AWARD', 'AWARE', 'BADLY', 'BAKER',
            'BANDS', 'BANKS', 'BASED', 'BASES', 'BASIC', 'BASIN', 'BASIS', 'BATCH', 'BEACH', 'BEGAN',
            'BEGIN', 'BEING', 'BELLY', 'BELOW', 'BENCH', 'BILLY', 'BIRTH', 'BLACK', 'BLADE', 'BLAME',
            'BLANK', 'BLEND', 'BLESS', 'BLIND', 'BLOCK', 'BLOOD', 'BLOOM', 'BOARD', 'BOOST', 'BOOTH',
            'BOUND', 'BRAIN', 'BRAND', 'BRASS', 'BRAVE', 'BREAD', 'BREAK', 'BREED', 'BRICK', 'BRIDE',
            'BRIEF', 'BRING', 'BROAD', 'BROKE', 'BROOK', 'BROWN', 'BRUSH', 'BUILD', 'BUILT', 'BUNCH',
            'BURNS', 'BURST', 'BUYER', 'CABIN', 'CABLE', 'CALIF', 'CAMEL', 'CANAL', 'CANDY', 'CANON',
            'CARGO', 'CAROL', 'CARRY', 'CATCH', 'CAUSE', 'CHAIN', 'CHAIR', 'CHAOS', 'CHARM', 'CHART',
            'CHASE', 'CHEAP', 'CHECK', 'CHEEK', 'CHEST', 'CHIEF', 'CHILD', 'CHINA', 'CHOSE', 'CIVIL',
            'CLAIM', 'CLASS', 'CLEAN', 'CLEAR', 'CLICK', 'CLIFF', 'CLIMB', 'CLOCK', 'CLONE', 'CLOSE',
            'CLOTH', 'CLOUD', 'COACH', 'COAST', 'CORAL', 'COUCH', 'COULD', 'COUNT', 'COUPE', 'COURT',
            'COVER', 'CRACK', 'CRAFT', 'CRASH', 'CRAZY', 'CREAM', 'CREEK', 'CRIME', 'CRISP', 'CROSS',
            'CROWD', 'CROWN', 'CRUDE', 'CRUSH', 'CURVE', 'CYCLE', 'DAILY', 'DAIRY', 'DANCE', 'DATED',
            'DEALT', 'DEATH', 'DEBUT', 'DECOR', 'DELAY', 'DELTA', 'DENSE', 'DEPOT', 'DEPTH', 'DERBY',
            'DEVIL', 'DIARY', 'DISCO', 'DOING', 'DOUBT', 'DOZEN', 'DRAFT', 'DRAIN', 'DRAMA', 'DRANK',
            'DRAWN', 'DREAM', 'DRESS', 'DRIED', 'DRILL', 'DRINK', 'DRIVE', 'DROVE', 'DROWN', 'DYING',
            'EAGER', 'EAGLE', 'EARLY', 'EARTH', 'EIGHT', 'ELBOW', 'ELDER', 'ELECT', 'ELITE', 'EMPTY',
            'ENEMY', 'ENJOY', 'ENTER', 'ENTRY', 'EQUAL', 'ERROR', 'EVENT', 'EVERY', 'EXACT', 'EXIST',
            'EXTRA', 'FACET', 'FAITH', 'FALSE', 'FANCY', 'FATAL', 'FAULT', 'FEAST', 'FENCE', 'FIBER',
            'FIELD', 'FIERY', 'FIFTH', 'FIFTY', 'FIGHT', 'FINAL', 'FIRST', 'FIXED', 'FLAME', 'FLASH',
            'FLEET', 'FLESH', 'FLOAT', 'FLOOD', 'FLOOR', 'FLOUR', 'FLUID', 'FLUSH', 'FOCUS', 'FORCE',
            'FORTH', 'FORTY', 'FORUM', 'FOUND', 'FRAME', 'FRANK', 'FRAUD', 'FRESH', 'FRIED', 'FRONT',
            'FROST', 'FRUIT', 'FULLY', 'FUNNY', 'GHOST', 'GIANT', 'GIVEN', 'GLASS', 'GLOBE', 'GLORY',
            'GLOVE', 'GOING', 'GRACE', 'GRADE', 'GRAIN', 'GRAND', 'GRANT', 'GRAPE', 'GRAPH', 'GRASS',
            'GRAVE', 'GREAT', 'GREED', 'GREEN', 'GREET', 'GRIEF', 'GRILL', 'GROSS', 'GROUP', 'GROVE',
            'GROWN', 'GUARD', 'GUESS', 'GUEST', 'GUIDE', 'GUILD', 'GUILT', 'HABIT', 'HAPPY', 'HARSH',
            'HARRY', 'HEART', 'HEAVY', 'HELLO', 'HENCE', 'HENRY', 'HORSE', 'HOTEL', 'HOUSE', 'HUMAN',
            'HUMOR', 'IDEAL', 'IMAGE', 'IMPLY', 'INDEX', 'INNER', 'INPUT', 'ISSUE', 'IVORY', 'JAPAN',
            'JIMMY', 'JOINT', 'JONES', 'JUDGE', 'JUICE', 'KNOWN', 'LABEL', 'LABOR', 'LARGE', 'LASER',
            'LATER', 'LAUGH', 'LAYER', 'LEARN', 'LEASE', 'LEAST', 'LEAVE', 'LEGAL', 'LEMON', 'LEVEL',
            'LEWIS', 'LIGHT', 'LIMIT', 'LINEN', 'LINKS', 'LIVER', 'LIVES', 'LOCAL', 'LOGIC', 'LOOSE',
            'LOWER', 'LOYAL', 'LUCKY', 'LUNCH', 'LYING', 'MAGIC', 'MAJOR', 'MAKER', 'MANOR', 'MAPLE',
            'MARCH', 'MARIA', 'MARRY', 'MATCH', 'MAYOR', 'MEANT', 'MEDAL', 'MEDIA', 'MELON', 'MERCY',
            'MERGE', 'MERIT', 'MERRY', 'METAL', 'METER', 'METRO', 'MIGHT', 'MINOR', 'MINUS', 'MIXED',
            'MODEL', 'MONEY', 'MONTH', 'MORAL', 'MOTOR', 'MOUNT', 'MOUSE', 'MOUTH', 'MOVED', 'MOVIE',
            'MUSIC', 'NEEDS', 'NERVE', 'NEVER', 'NEWLY', 'NIGHT', 'NINTH', 'NOBLE', 'NOISE', 'NORTH',
            'NOTED', 'NOVEL', 'NURSE', 'OCCUR', 'OCEAN', 'OFFER', 'OFTEN', 'OLIVE', 'ONION', 'OPERA',
            'ORBIT', 'ORDER', 'ORGAN', 'OTHER', 'OUGHT', 'OUTER', 'OWNER', 'OXIDE', 'PAINT', 'PANEL',
            'PANIC', 'PAPER', 'PARKS', 'PARTY', 'PASTA', 'PATCH', 'PAUSE', 'PEACE', 'PEACH', 'PEARL',
            'PENNY', 'PETER', 'PHASE', 'PHONE', 'PHOTO', 'PIANO', 'PIECE', 'PILOT', 'PINCH', 'PITCH',
            'PIXEL', 'PIZZA', 'PLACE', 'PLAIN', 'PLANE', 'PLANT', 'PLATE', 'PLAZA', 'PLUMB', 'POINT',
            'POKER', 'POLAR', 'PORCH', 'POUND', 'POWER', 'PRESS', 'PRICE', 'PRIDE', 'PRIME', 'PRINT',
            'PRIOR', 'PRISM', 'PRIZE', 'PROOF', 'PROUD', 'PROVE', 'PRUNE', 'PULSE', 'PUPIL', 'PURSE',
            'QUEEN', 'QUEST', 'QUEUE', 'QUICK', 'QUIET', 'QUITE', 'QUOTE', 'RADAR', 'RADIO', 'RAINY',
            'RAISE', 'RALLY', 'RANCH', 'RANGE', 'RAPID', 'RATIO', 'RAZOR', 'REACH', 'READY', 'REALM',
            'REBEL', 'REFER', 'RELAX', 'REPLY', 'RIDGE', 'RIFLE', 'RIGHT', 'RIGID', 'RINSE', 'RISKY',
            'RIVAL', 'RIVER', 'ROBIN', 'ROCKY', 'RODEO', 'ROMAN', 'ROUGH', 'ROUND', 'ROUTE', 'ROVER',
            'ROYAL', 'RULER', 'RUMOR', 'RURAL', 'RUSTY', 'SADLY', 'SAFER', 'SAINT', 'SALAD', 'SALON',
            'SAUCE', 'SCALE', 'SCARE', 'SCARF', 'SCENE', 'SCENT', 'SCOPE', 'SCORE', 'SCOUT', 'SCRAP',
            'SCREW', 'SEIZE', 'SENSE', 'SERVE', 'SETUP', 'SEVEN', 'SHADE', 'SHAFT', 'SHAKE', 'SHALL',
            'SHAME', 'SHAPE', 'SHARE', 'SHARP', 'SHAVE', 'SHEEP', 'SHEER', 'SHEET', 'SHELF', 'SHELL',
            'SHIFT', 'SHINE', 'SHIRT', 'SHOCK', 'SHOOT', 'SHORT', 'SHOWN', 'SIDED', 'SIGHT', 'SINCE',
            'SIXTH', 'SIXTY', 'SIZED', 'SKILL', 'SLASH', 'SLATE', 'SLAVE', 'SLEEP', 'SLIDE', 'SLOPE',
            'SMALL', 'SMART', 'SMILE', 'SMITH', 'SMOKE', 'SNAKE', 'SOLID', 'SOLVE', 'SORRY', 'SOUND',
            'SOUTH', 'SPACE', 'SPARE', 'SPEAK', 'SPEED', 'SPELL', 'SPEND', 'SPENT', 'SPLIT', 'SPOKE',
            'SPORT', 'SPRAY', 'SQUAD', 'STAFF', 'STAGE', 'STAKE', 'STAND', 'START', 'STATE', 'STEAM',
            'STEEL', 'STEEP', 'STEER', 'STICK', 'STILL', 'STOCK', 'STONE', 'STOOD', 'STORE', 'STORM',
            'STORY', 'STRAP', 'STRAW', 'STRIP', 'STUCK', 'STUDY', 'STUFF', 'STYLE', 'SUGAR', 'SUITE',
            'SUNNY', 'SUPER', 'SURGE', 'SWAMP', 'SWEAR', 'SWEAT', 'SWEEP', 'SWEET', 'SWELL', 'SWEPT',
            'SWIFT', 'SWINE', 'SWING', 'SWISS', 'SWORD', 'TABLE', 'TAKEN', 'TASTE', 'TAXES', 'TEACH',
            'TEMPO', 'TERMS', 'TERRA', 'TEXAS', 'THANK', 'THEFT', 'THEIR', 'THEME', 'THERE', 'THESE',
            'THICK', 'THING', 'THINK', 'THIRD', 'THORN', 'THOSE', 'THREE', 'THREW', 'THROW', 'THUMB',
            'TIGHT', 'TIMER', 'TIMES', 'TITAN', 'TITLE', 'TOAST', 'TODAY', 'TOKEN', 'TONIC', 'TOPIC',
            'TOTAL', 'TOUCH', 'TOUGH', 'TOWEL', 'TOWER', 'TOXIC', 'TRACE', 'TRACK', 'TRACT', 'TRADE',
            'TRAIL', 'TRAIN', 'TRAIT', 'TRAMP', 'TRASH', 'TRAWL', 'TREAD', 'TREAT', 'TREND', 'TRIAL',
            'TRIBE', 'TRICK', 'TRIED', 'TROOP', 'TROUT', 'TRUCK', 'TRULY', 'TRUMP', 'TRUNK', 'TRUST',
            'TRUTH', 'TULIP', 'TUMOR', 'TUNIC', 'TWICE', 'TWINS', 'TWIST', 'UDDER', 'ULTRA', 'UNCLE',
            'UNDER', 'UNDUE', 'UNFED', 'UNION', 'UNITE', 'UNITY', 'UNTIL', 'UPPER', 'UPSET', 'URBAN',
            'USAGE', 'USUAL', 'VALID', 'VALUE', 'VAPOR', 'VAULT', 'VENUE', 'VERSE', 'VIDEO', 'VIGOR',
            'VILLA', 'VINYL', 'VIOLA', 'VIPER', 'VIRAL', 'VIRUS', 'VISIT', 'VITAL', 'VIVID', 'VOCAL',
            'VODKA', 'VOGUE', 'VOICE', 'VOTER', 'WAGES', 'WAGON', 'WAIST', 'WASTE', 'WATCH', 'WATER',
            'WAVED', 'WAVES', 'WHEAT', 'WHEEL', 'WHERE', 'WHICH', 'WHILE', 'WHITE', 'WHOLE', 'WHOSE',
            'WIDER', 'WIDOW', 'WIDTH', 'WIELD', 'WOMAN', 'WOMEN', 'WORLD', 'WORRY', 'WORSE', 'WORST',
            'WORTH', 'WOULD', 'WOUND', 'WOVEN', 'WRIST', 'WRITE', 'WRONG', 'WROTE', 'YACHT', 'YEARN',
            'YIELD', 'YOUNG', 'YOUTH', 'ZEBRA', 'ZONED'
        ];

        // Get today's date as a seed for consistent daily words
        function getDailySeed() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            return parseInt(year + month + day) * 377 + 12345;
        }

        // Proper seeded random number generator (LCG algorithm)
        function createSeededRandom(seed) {
            let state = seed % 4294967296;
            return function() {
                state = (state * 1664525 + 1013904223) % 4294967296;
                return state / 4294967296;
            };
        }

        // Select 8 random words for today
        function getDailyWords() {
            const seed = getDailySeed();
            const random = createSeededRandom(seed);
            const shuffled = [...WORD_DATABASE];
            
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            
            return shuffled.slice(0, 8);
        }
        
        // Store puzzle data for Game Shelf Hint Helper (does NOT expose words/answers)
        function storeHintData() {
            try {
                const today = new Date();
                const launchDate = new Date('2024-06-03');
                const puzzleNumber = Math.floor((today - launchDate) / (1000 * 60 * 60 * 24)) + 1;
                
                const hintData = {
                    gameId: 'slate',
                    gameName: 'Slate',
                    puzzleNumber: puzzleNumber,
                    timestamp: Date.now(),
                    data: {
                        // Expose progress, NOT the answers
                        wordsCompleted: wordsCompleted,
                        totalWords: 5,
                        difficulty: difficultyMode,
                        currentRow: wordsCompleted + 1
                    }
                };
                localStorage.setItem('gameshelf_hint_data', JSON.stringify(hintData));
                console.log('üìù Slate hint data stored for puzzle #' + puzzleNumber);
            } catch (e) {
                console.warn('Could not store hint data:', e);
            }
        }

        const words = getDailyWords();
        console.log('Today\'s words:', words);

        const vowels = ['A', 'E', 'I', 'O', 'U'];
        const consonants = ['B', 'C', 'D', 'F', 'G', 'H', 'J', 'K', 'L', 'M', 'N', 'P', 'Q', 'R', 'S', 'T', 'V', 'W', 'X', 'Y', 'Z'];

        let consonantCount = 0;
        let currentScore = 0;
        let wordsCompleted = 0;
        let revealedConsonants = new Set();
        let completedWordIndices = new Set();
        let selectedSquare = null;
        // Game URL for sharing
        const GAME_URL = 'https://rfrbrn.github.io/slate/slate.html'; // Update this when hosted
        
        let difficultyMode = localStorage.getItem('slateDifficulty') || 'easy';
        let consonantConfirmation = localStorage.getItem('slateConsonantConfirm') !== 'false';
        let showIntroOnStart = localStorage.getItem('slateShowIntro') !== 'false';
        let tutorialCompleted = localStorage.getItem('slateTutorialDone') === 'true';
        let skipIntroAfterTutorial = false;
        let currentTutorialStep = 1;
        const totalTutorialSteps = 4;
        let pendingConsonant = null;
        let gameOver = false;
        const POINT_LIMIT = 50;
        
        // Sound system
        let soundEnabled = localStorage.getItem('slateSound') !== 'false';
        
        // Plain Mode - defaults to ON for first run (free tier)
        if (localStorage.getItem('slatePlainMode') === null) {
            localStorage.setItem('slatePlainMode', 'true');
        }
        let plainMode = localStorage.getItem('slatePlainMode') === 'true';
        let audioContext = null;
        
        // v1.0.9: Save/restore in-progress game state to survive page reloads
        function saveGameState() {
            if (isPracticeMode || gameOver) return; // Don't save practice or completed games
            
            const today = getTodayString();
            const state = {
                date: today,
                consonantCount,
                currentScore,
                wordsCompleted,
                revealedConsonants: Array.from(revealedConsonants),
                completedWordIndices: Array.from(completedWordIndices),
                // Save individual cell fills (for per-square guesses)
                cellFills: []
            };
            
            // Collect cells that have been individually filled (not via global reveal)
            document.querySelectorAll('.cell[data-guessed="true"]').forEach(cell => {
                state.cellFills.push({
                    row: parseInt(cell.dataset.row),
                    col: parseInt(cell.dataset.col),
                    letter: cell.textContent
                });
            });
            
            try {
                localStorage.setItem('slateGameState', JSON.stringify(state));
            } catch (e) {
                console.error('Error saving game state:', e);
            }
        }
        
        function loadGameState() {
            try {
                const saved = localStorage.getItem('slateGameState');
                if (!saved) return null;
                
                const state = JSON.parse(saved);
                const today = getTodayString();
                
                // Only restore if it's from today and game not finished
                if (state.date === today && !hasPlayedToday()) {
                    return state;
                }
                
                // Clear stale state
                localStorage.removeItem('slateGameState');
                return null;
            } catch (e) {
                console.error('Error loading game state:', e);
                return null;
            }
        }
        
        function restoreGameState(state) {
            console.log('üîÑ Restoring saved game state');
            
            // Restore consonants and scores
            consonantCount = state.consonantCount || 0;
            currentScore = state.currentScore || 0;
            wordsCompleted = state.wordsCompleted || 0;
            revealedConsonants = new Set(state.revealedConsonants || []);
            completedWordIndices = new Set(state.completedWordIndices || []);
            
            // Restore globally revealed consonants to grid
            revealedConsonants.forEach(letter => {
                document.querySelectorAll(`.cell[data-letter="${letter}"]`).forEach(cell => {
                    if (!cell.classList.contains('vowel') && !completedWordIndices.has(parseInt(cell.dataset.row))) {
                        cell.textContent = letter;
                        cell.classList.remove('empty', 'clickable');
                        cell.classList.add('consonant');
                        cell.dataset.guessed = 'false';
                    }
                });
                // Disable bottom bar button
                const btn = document.getElementById(`bottom-btn-${letter}`);
                if (btn) {
                    btn.disabled = true;
                    btn.classList.add('used');
                }
                // Disable modal button too
                const modalBtn = document.getElementById(`modal-btn-${letter}`);
                if (modalBtn) {
                    modalBtn.disabled = true;
                    modalBtn.classList.add('used');
                }
            });
            
            // Restore individual cell fills
            (state.cellFills || []).forEach(fill => {
                const cell = document.querySelector(`.cell[data-row="${fill.row}"][data-col="${fill.col}"]`);
                if (cell && !cell.classList.contains('vowel') && cell.classList.contains('empty')) {
                    cell.textContent = fill.letter;
                    cell.classList.remove('empty', 'clickable');
                    cell.classList.add('consonant');
                    cell.dataset.guessed = 'true';
                    cell.onclick = () => openModalForSquare(cell);
                }
            });
            
            // Restore completed word styling
            completedWordIndices.forEach(rowIndex => {
                document.querySelectorAll(`.cell[data-row="${rowIndex}"]`).forEach(cell => {
                    cell.style.background = '#5a7d5a';
                    cell.classList.remove('clickable');
                    cell.onclick = null;
                });
            });
            
            // Update display
            updateDisplay();
        }
        
        function clearGameState() {
            localStorage.removeItem('slateGameState');
        }
        
        function getAudioContext() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            return audioContext;
        }
        
        function playTone(frequency, duration, type = 'sine', volume = 0.3) {
            if (!soundEnabled) return;
            
            try {
                const ctx = getAudioContext();
                const oscillator = ctx.createOscillator();
                const gainNode = ctx.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(ctx.destination);
                
                oscillator.frequency.value = frequency;
                oscillator.type = type;
                
                gainNode.gain.setValueAtTime(volume, ctx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + duration);
                
                oscillator.start(ctx.currentTime);
                oscillator.stop(ctx.currentTime + duration);
            } catch (e) {
                console.error('Sound error:', e);
            }
        }
        
        function playClickSound() {
            if (!soundEnabled) return;
            playTone(600, 0.08, 'sine', 0.2);
        }
        
        function playPlaceSound() {
            if (!soundEnabled) return;
            playTone(440, 0.1, 'sine', 0.25);
        }
        
        function playWordCompleteSound() {
            if (!soundEnabled) return;
            // Rising success sound
            playTone(523.25, 0.12, 'sine', 0.25); // C5
            setTimeout(() => playTone(659.25, 0.12, 'sine', 0.25), 80); // E5
            setTimeout(() => playTone(783.99, 0.2, 'sine', 0.3), 160); // G5
        }
        
        function playErrorSound() {
            if (!soundEnabled) return;
            // Soft descending tone
            playTone(349.23, 0.15, 'triangle', 0.2); // F4
            setTimeout(() => playTone(293.66, 0.2, 'triangle', 0.15), 120); // D4
        }
        
        function playWinSound() {
            if (!soundEnabled) return;
            // Celebratory fanfare
            playTone(523.25, 0.12, 'sine', 0.25); // C5
            setTimeout(() => playTone(659.25, 0.12, 'sine', 0.25), 100); // E5
            setTimeout(() => playTone(783.99, 0.12, 'sine', 0.25), 200); // G5
            setTimeout(() => playTone(1046.50, 0.35, 'sine', 0.35), 300); // C6
        }
        
        function playLoseSound() {
            if (!soundEnabled) return;
            // Somber descending
            playTone(392.00, 0.2, 'triangle', 0.2); // G4
            setTimeout(() => playTone(329.63, 0.2, 'triangle', 0.18), 180); // E4
            setTimeout(() => playTone(261.63, 0.35, 'triangle', 0.15), 360); // C4
        }
        
        function toggleSound() {
            soundEnabled = document.getElementById('sound-toggle').checked;
            localStorage.setItem('slateSound', soundEnabled);
            if (soundEnabled) {
                playTone(440, 0.1, 'sine', 0.2);
            }
        }
        
        function testSounds() {
            const wasEnabled = soundEnabled;
            soundEnabled = true;
            playWordCompleteSound();
            setTimeout(() => {
                playErrorSound();
                soundEnabled = wasEnabled;
                
                // v1.0.14: Show mute reminder (browsers can't detect hardware mute)
                setTimeout(() => {
                    showMessage('üîá No sound? Check if your device is muted', 'info');
                }, 400);
            }, 500);
        }
        
        // Plain Mode Functions
        function togglePlainMode() {
            plainMode = document.getElementById('plain-mode-toggle').checked;
            localStorage.setItem('slatePlainMode', plainMode);
            applyPlainMode();
            
            // If Plain Mode is turned ON while signed in, sign out
            if (plainMode && typeof GSAuth !== 'undefined' && GSAuth.isSignedIn()) {
                GSAuth.signOut();
            }
            
            // Update account section
            if (typeof GSAuth !== 'undefined') {
                GSAuth.updateUI();
            }
        }
        
        function initPlainModeToggle() {
            const toggle = document.getElementById('plain-mode-toggle');
            if (toggle) {
                toggle.checked = plainMode;
            }
        }
        
        function applyPlainMode() {
            if (plainMode) {
                document.body.classList.add('plain-mode');
                // Hide sync indicator in Plain Mode
                const syncIndicator = document.getElementById('sync-indicator');
                if (syncIndicator) syncIndicator.style.display = 'none';
            } else {
                document.body.classList.remove('plain-mode');
            }
        }
        
        // Practice Mode
        let isPracticeMode = false;
        let practiceDate = null;
        let currentPickerMonth = new Date();
        const LAUNCH_DATE = new Date('2026-01-01'); // Slate launch date
        
        function getPracticeStats() {
            try {
                const stats = localStorage.getItem('slatePracticeStats');
                if (stats) return JSON.parse(stats);
            } catch (e) {
                console.error('Error reading practice stats:', e);
            }
            return { played: 0, won: 0, history: {} };
        }
        
        function savePracticeStats(stats) {
            try {
                localStorage.setItem('slatePracticeStats', JSON.stringify(stats));
            } catch (e) {
                console.error('Error saving practice stats:', e);
            }
        }
        
        function recordPracticeResult(won, score) {
            if (!isPracticeMode || !practiceDate) return;
            
            const stats = getPracticeStats();
            const dateStr = formatDateString(practiceDate);
            
            if (!stats.history[dateStr]) {
                stats.played++;
                if (won) stats.won++;
                stats.history[dateStr] = { won: won, score: score, date: dateStr };
                savePracticeStats(stats);
            }
        }
        
        function formatDateString(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        function getDailyWordsForDate(date) {
            const dateCopy = new Date(date);
            dateCopy.setHours(0, 0, 0, 0);
            const year = dateCopy.getFullYear();
            const month = String(dateCopy.getMonth() + 1).padStart(2, '0');
            const day = String(dateCopy.getDate()).padStart(2, '0');
            const seed = parseInt(`${year}${month}${day}`, 10);
            
            let state = seed % 4294967296;
            const random = () => {
                state = (state * 1664525 + 1013904223) % 4294967296;
                return state / 4294967296;
            };
            
            const shuffled = [...WORD_DATABASE];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled.slice(0, 8);
        }
        
        function openPracticeModal() {
            closeMenu();
            currentPickerMonth = new Date();
            renderDatePicker();
            updatePracticeStatsDisplay();
            document.getElementById('practice-modal').classList.add('active');
        }
        
        function closePracticeModal() {
            document.getElementById('practice-modal').classList.remove('active');
        }
        
        function updatePracticeStatsDisplay() {
            const stats = getPracticeStats();
            document.getElementById('practice-played').textContent = stats.played;
            document.getElementById('practice-won').textContent = stats.won;
            const rate = stats.played > 0 ? Math.round((stats.won / stats.played) * 100) : 0;
            document.getElementById('practice-rate').textContent = rate + '%';
        }
        
        function changeMonth(delta) {
            currentPickerMonth.setMonth(currentPickerMonth.getMonth() + delta);
            renderDatePicker();
        }
        
        function renderDatePicker() {
            const grid = document.getElementById('date-picker-grid');
            const monthLabel = document.getElementById('current-month');
            
            const year = currentPickerMonth.getFullYear();
            const month = currentPickerMonth.getMonth();
            
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                               'July', 'August', 'September', 'October', 'November', 'December'];
            monthLabel.textContent = `${monthNames[month]} ${year}`;
            
            // Clear existing day cells (keep header labels)
            const dayLabels = grid.querySelectorAll('.date-picker-day-label');
            grid.innerHTML = '';
            dayLabels.forEach(label => grid.appendChild(label.cloneNode(true)));
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const practiceStats = getPracticeStats();
            
            // Add empty cells for days before first of month
            for (let i = 0; i < firstDay.getDay(); i++) {
                const empty = document.createElement('div');
                empty.className = 'date-picker-day empty';
                grid.appendChild(empty);
            }
            
            // Add day cells
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const dateCell = document.createElement('div');
                dateCell.className = 'date-picker-day';
                dateCell.textContent = day;
                
                const cellDate = new Date(year, month, day);
                cellDate.setHours(0, 0, 0, 0);
                const dateStr = formatDateString(cellDate);
                
                const launchCopy = new Date(LAUNCH_DATE);
                launchCopy.setHours(0, 0, 0, 0);
                
                if (cellDate < launchCopy) {
                    dateCell.classList.add('disabled');
                } else if (cellDate >= today) {
                    dateCell.classList.add('future');
                    if (cellDate.getTime() === today.getTime()) {
                        dateCell.classList.add('today');
                        dateCell.title = "Play today's puzzle from main screen";
                    }
                } else {
                    if (practiceStats.history[dateStr]) {
                        dateCell.classList.add('played');
                        if (practiceStats.history[dateStr].won) {
                            dateCell.classList.add('won');
                        } else {
                            dateCell.classList.add('lost');
                        }
                    }
                    
                    dateCell.onclick = () => startPractice(cellDate);
                    dateCell.style.cursor = 'pointer';
                }
                
                grid.appendChild(dateCell);
            }
            
            // Update nav button states
            const launchMonth = new Date(LAUNCH_DATE.getFullYear(), LAUNCH_DATE.getMonth(), 1);
            const currentMonth = new Date(year, month, 1);
            const todayMonth = new Date(today.getFullYear(), today.getMonth(), 1);
            
            document.getElementById('prev-month').disabled = currentMonth <= launchMonth;
            document.getElementById('next-month').disabled = currentMonth >= todayMonth;
        }
        
        function startPractice(date) {
            isPracticeMode = true;
            practiceDate = date;
            
            closePracticeModal();
            
            // Reset game state
            consonantCount = 0;
            currentScore = 0;
            wordsCompleted = 0;
            revealedConsonants = new Set();
            completedWordIndices = new Set();
            selectedSquare = null;
            gameOver = false;
            
            // Get words for selected date
            const practiceWords = getDailyWordsForDate(date);
            
            // Reinitialize grid with practice words
            initGridWithWords(practiceWords);
            
            // Update subtitle to show practice mode
            const dateStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
            document.querySelector('.subtitle').innerHTML =
                `Daily puzzle &bull; ${dateStr} <span class="practice-badge">Practice</span>`;
            
            updateUI();
        }
        
        function initGridWithWords(wordList) {
            // Clear existing grid
            const grid = document.getElementById('slate-grid');
            grid.innerHTML = '';
            
            // Rebuild grid with new words
            wordList.forEach((word, rowIndex) => {
                for (let colIndex = 0; colIndex < 5; colIndex++) {
                    const letter = word[colIndex];
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    cell.dataset.row = rowIndex;
                    cell.dataset.col = colIndex;
                    cell.dataset.letter = letter;
                    
                    if (vowels.includes(letter)) {
                        cell.classList.add('vowel');
                        cell.textContent = letter;
                    } else {
                        cell.classList.add('consonant');
                        cell.onclick = () => openConsonantPicker(rowIndex, colIndex);
                    }
                    
                    grid.appendChild(cell);
                }
            });
            
            // Reset consonant buttons
            const buttonGrid = document.getElementById('consonant-buttons');
            buttonGrid.innerHTML = '';
            consonants.forEach(c => {
                const btn = document.createElement('button');
                btn.className = 'consonant-btn';
                btn.textContent = c;
                btn.dataset.consonant = c;
                btn.onclick = () => handleConsonantButtonClick(c);
                buttonGrid.appendChild(btn);
            });
        }
        
        function returnToDaily() {
            isPracticeMode = false;
            practiceDate = null;
            
            closePracticeModal();
            
            // Reload daily puzzle
            location.reload();
        }
        
        // Reset Statistics
        function resetStatistics() {
            if (confirm('Are you sure you want to reset all your statistics? This cannot be undone.')) {
                localStorage.removeItem('slateStats');
                localStorage.removeItem('slateLastPlayed');
                localStorage.removeItem('slatePracticeStats');
                alert('Statistics have been reset.');
                closeMenu();
            }
        }

        // Stats functions
        function getTodayString() {
            const now = new Date();
            return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
        }

        function getStats() {
            try {
                const stats = localStorage.getItem('slateStats');
                if (stats) {
                    return JSON.parse(stats);
                }
            } catch (e) {
                console.error('Error reading stats from localStorage:', e);
            }
            return {
                gamesPlayed: 0,
                gamesWon: 0,
                currentStreak: 0,
                maxStreak: 0,
                totalScore: 0,
                bestScore: null,
                lastPlayedDate: null,
                ratingDistribution: {
                    'Perfect': 0,
                    'Master': 0,
                    'Expert': 0,
                    'Skilled': 0,
                    'Proficient': 0,
                    'Competent': 0,
                    'Developing': 0,
                    'Completed': 0
                }
            };
        }

        function saveStats(stats) {
            try {
                localStorage.setItem('slateStats', JSON.stringify(stats));
            } catch (e) {
                console.error('Error saving stats to localStorage:', e);
            }
        }

        function hasPlayedToday() {
            const stats = getStats();
            const today = getTodayString();
            return stats.lastPlayedDate === today;
        }

        function getTodayResult() {
            try {
                const result = localStorage.getItem('slateTodayResult');
                if (result) {
                    const parsed = JSON.parse(result);
                    // Verify it's from today
                    if (parsed.date === getTodayString()) {
                        return parsed;
                    }
                }
            } catch (e) {
                console.error('Error reading today result:', e);
            }
            return null;
        }

        function saveTodayResult(won, score, wordsCompletedCount, shareText, mode) {
            try {
                const result = {
                    date: getTodayString(),
                    won: won,
                    score: score,
                    wordsCompleted: wordsCompletedCount,
                    shareText: shareText,
                    mode: mode
                };
                localStorage.setItem('slateTodayResult', JSON.stringify(result));
            } catch (e) {
                console.error('Error saving today result:', e);
            }
        }

        function getRatingFromScore(score) {
            if (score === 0) return 'Perfect';
            if (score <= 8) return 'Master';
            if (score <= 16) return 'Expert';
            if (score <= 24) return 'Skilled';
            if (score <= 32) return 'Proficient';
            if (score <= 40) return 'Competent';
            if (score <= 48) return 'Developing';
            return 'Completed';
        }

        function updateStats(won, score) {
            const stats = getStats();
            const today = getTodayString();
            
            // Check if already played today
            if (stats.lastPlayedDate === today) {
                return stats; // Don't update stats if replaying
            }
            
            stats.gamesPlayed += 1;
            
            if (won) {
                stats.gamesWon += 1;
                stats.totalScore += score;
                
                // Update best score
                if (stats.bestScore === null || score < stats.bestScore) {
                    stats.bestScore = score;
                }
                
                // Update rating distribution
                const rating = getRatingFromScore(score);
                if (stats.ratingDistribution[rating] !== undefined) {
                    stats.ratingDistribution[rating] += 1;
                }
                
                // Update streak
                if (stats.lastPlayedDate) {
                    const lastDate = new Date(stats.lastPlayedDate);
                    const todayDate = new Date(today);
                    const diffDays = Math.floor((todayDate - lastDate) / (1000 * 60 * 60 * 24));
                    
                    if (diffDays === 1) {
                        stats.currentStreak += 1;
                    } else {
                        stats.currentStreak = 1;
                    }
                } else {
                    stats.currentStreak = 1;
                }
                
                if (stats.currentStreak > stats.maxStreak) {
                    stats.maxStreak = stats.currentStreak;
                }
            } else {
                stats.currentStreak = 0;
            }
            
            stats.lastPlayedDate = today;
            saveStats(stats);
            return stats;
        }

        function generateStatsHTML(stats) {
            const winRate = stats.gamesPlayed > 0 ? Math.round((stats.gamesWon / stats.gamesPlayed) * 100) : 0;
            const avgScore = stats.gamesWon > 0 ? (stats.totalScore / stats.gamesWon).toFixed(1) : '-';
            
            // Generate rating distribution bars
            const maxCount = Math.max(...Object.values(stats.ratingDistribution), 1);
            let distributionHTML = '';
            const ratings = ['Perfect', 'Master', 'Expert', 'Skilled', 'Proficient', 'Competent', 'Developing', 'Completed'];
            
            ratings.forEach(rating => {
                const count = stats.ratingDistribution[rating] || 0;
                const percentage = (count / maxCount) * 100;
                distributionHTML += `
                    <div style="display: flex; align-items: center; gap: 8px; margin: 4px 0;">
                        <div style="width: 70px; font-size: 0.75rem; color: #a8b896; text-align: right;">${rating}</div>
                        <div style="flex: 1; background: rgba(0,0,0,0.3); border-radius: 3px; height: 16px; overflow: hidden;">
                            <div style="width: ${percentage}%; background: #5a7d5a; height: 100%; min-width: ${count > 0 ? '20px' : '0'}; display: flex; align-items: center; justify-content: flex-end; padding-right: 6px;">
                                ${count > 0 ? `<span style="font-size: 0.7rem; color: #fff;">${count}</span>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            return `
                <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 8px; margin: 20px 0;">
                    <h3 style="font-family: 'Permanent Marker', cursive; color: #f4e4c1; margin-bottom: 15px; text-align: center;">
                        üìä Your Statistics
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; text-align: center; margin-bottom: 20px;">
                        <div>
                            <div style="font-size: 1.8rem; font-weight: bold; color: #ffd700;">${stats.gamesPlayed}</div>
                            <div style="font-size: 0.75rem; color: #a8b896;">Played</div>
                        </div>
                        <div>
                            <div style="font-size: 1.8rem; font-weight: bold; color: #ffd700;">${winRate}%</div>
                            <div style="font-size: 0.75rem; color: #a8b896;">Win Rate</div>
                        </div>
                        <div>
                            <div style="font-size: 1.8rem; font-weight: bold; color: #ffd700;">${stats.currentStreak}</div>
                            <div style="font-size: 0.75rem; color: #a8b896;">Streak</div>
                        </div>
                        <div>
                            <div style="font-size: 1.8rem; font-weight: bold; color: #ffd700;">${stats.maxStreak}</div>
                            <div style="font-size: 0.75rem; color: #a8b896;">Max Streak</div>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; text-align: center; margin-bottom: 15px;">
                        <div>
                            <div style="font-size: 1.4rem; font-weight: bold; color: #a8d5a8;">${avgScore}</div>
                            <div style="font-size: 0.75rem; color: #a8b896;">Avg Score</div>
                        </div>
                        <div>
                            <div style="font-size: 1.4rem; font-weight: bold; color: #a8d5a8;">${stats.bestScore !== null ? stats.bestScore : '-'}</div>
                            <div style="font-size: 0.75rem; color: #a8b896;">Best Score</div>
                        </div>
                    </div>
                    ${stats.gamesWon > 0 ? `
                        <div style="border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px; margin-top: 10px;">
                            <div style="font-size: 0.85rem; color: #c9b896; margin-bottom: 10px; text-align: center;">Rating Distribution</div>
                            ${distributionHTML}
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function showAlreadyPlayed() {
            const result = getTodayResult();
            const stats = getStats();
            
            const gameOverEl = document.getElementById('game-over');
            gameOverEl.style.display = 'block';
            gameOver = true;
            
            // Calculate puzzle number
            const today = new Date();
            const launchDate = new Date('2026-01-09');
            launchDate.setHours(0, 0, 0, 0);
            today.setHours(0, 0, 0, 0);
            const puzzleNumber = Math.floor((today - launchDate) / (1000 * 60 * 60 * 24)) + 1;
            
            // If we don't have result details, show basic "already played" message
            if (!result) {
                gameOverEl.innerHTML = `
                    <div class="game-over">
                        <h2 style="margin-bottom: 10px; color: #a8d5a8;">&#10004; Already Played Today</h2>
                        <p style="color: #c9b896; margin-bottom: 20px;">You completed Slate #${puzzleNumber} earlier</p>
                        <p style="color: #a8b896; font-size: 0.9rem; margin-bottom: 30px;">Come back tomorrow for a new puzzle!</p>
                        
                        <div style="display: flex; flex-direction: column; gap: 15px; margin-top: 30px;">
                            <button onclick="showStats()" class="modal-close" style="background: #5a7d5a;">
                                &#128202; View Stats
                            </button>
                            <button onclick="openDatePicker()" class="modal-close" style="background: #6b5a7d;">
                                &#128197; Practice Past Puzzles
                            </button>
                        </div>
                    </div>
                `;
                return;
            }
            
            // Get rating info
            let rating, emoji;
            if (!result.won) {
                rating = 'POINTS EXCEEDED';
                emoji = 'üíÄ';
            } else if (result.score === 0) {
                rating = 'PERFECT!';
                emoji = 'üèÜ';
            } else if (result.score <= 8) {
                rating = 'MASTER';
                emoji = '‚≠ê‚≠ê‚≠ê';
            } else if (result.score <= 16) {
                rating = 'EXPERT';
                emoji = '‚≠ê‚≠ê';
            } else if (result.score <= 24) {
                rating = 'SKILLED';
                emoji = '‚≠ê';
            } else if (result.score <= 32) {
                rating = 'PROFICIENT';
                emoji = '‚ú®';
            } else if (result.score <= 40) {
                rating = 'COMPETENT';
                emoji = 'üëç';
            } else if (result.score <= 48) {
                rating = 'DEVELOPING';
                emoji = 'üìö';
            } else {
                rating = 'COMPLETED';
                emoji = '‚úì';
            }
            
            const modeText = result.mode === 'easy' ? 'Easy Mode' : 'Hard Mode';
            const modeEmoji = result.mode === 'easy' ? 'üü¢' : 'üî¥';
            
            gameOverEl.innerHTML = `
                <div class="game-over">
                    <h2 style="margin-bottom: 10px; color: #a8d5a8;">‚úÖ Already Played</h2>
                    <p style="color: #c9b896; margin-bottom: 20px;">You completed Slate #${puzzleNumber} today</p>
                    
                    <div style="margin: 30px 0;">
                        <div style="font-size: 3.5rem; margin-bottom: 10px;">${emoji}</div>
                        <div style="font-size: 2rem; color: ${result.won ? '#ffd700' : '#ff6666'}; font-family: 'Permanent Marker', cursive; margin-bottom: 15px;">
                            ${rating}
                        </div>
                        <div class="final-score" style="font-size: 4rem; color: ${result.won ? '#f4e4c1' : '#ff6666'}; margin: 20px 0; font-weight: 700;">
                            ${result.score}
                        </div>
                    </div>
                    
                    <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 8px; margin: 30px 0;">
                        <h3 style="font-family: 'Permanent Marker', cursive; color: #f4e4c1; margin-bottom: 15px;">
                            Today's Result
                        </h3>
                        <div style="color: #a8b896; font-size: 1rem; line-height: 2;">
                            <div>${modeEmoji} Mode: <strong style="color: #d5a8a8;">${modeText}</strong></div>
                            <div>${result.won ? '‚úì' : '‚úó'} Words Completed: <strong style="color: ${result.won ? '#5a9a7a' : '#ff6666'};">${result.wordsCompleted}/8</strong></div>
                            <div>üéØ Final Score: <strong style="color: ${result.won ? '#ffd700' : '#ff6666'};">${result.score}</strong></div>
                            ${stats.currentStreak > 1 ? `<div>üî• Current Streak: <strong style="color: #ffa500;">${stats.currentStreak}</strong></div>` : ''}
                        </div>
                    </div>
                    
                    <button onclick="shareFromSaved()" style="margin: 20px 0; padding: 15px 40px; font-size: 1.1rem; background: ${result.won ? '#5a7d5a' : '#7a5a5a'}; display: flex; align-items: center; justify-content: center; gap: 10px; width: 100%; max-width: 300px; margin-left: auto; margin-right: auto;">
                        <span>üì§</span> Share Results
                    </button>
                    <div id="share-confirmation" style="font-size: 0.9rem; color: #5a9a7a; margin-bottom: 15px; opacity: 0; transition: opacity 0.3s;"></div>
                    
                    <div style="font-size: 0.95rem; color: #a8b896; margin-top: 25px; line-height: 1.6;">
                        ‚è∞ Come back tomorrow for a new puzzle!
                    </div>
                </div>
            `;
        }

        function shareFromSaved() {
            const result = getTodayResult();
            if (!result || !result.shareText) {
                showShareConfirmation('Unable to share - no saved result');
                return;
            }
            
            if (navigator.share) {
                navigator.share({
                    title: 'Slate',
                    text: result.shareText
                }).then(() => {
                    showShareConfirmation('‚úì Shared successfully!');
                }).catch(err => {
                    if (err.name !== 'AbortError') {
                        copyToClipboard(result.shareText);
                    }
                });
            } else {
                copyToClipboard(result.shareText);
            }
        }

        function initGame() {
            // Check if already played today (daily mode only)
            if (!isPracticeMode && hasPlayedToday()) {
                showAlreadyPlayed();
                return;
            }
            
            createGrid();
            createBottomConsonants();
            createModalConsonants();
            
            // v1.0.9: Restore saved game state if available
            const savedState = loadGameState();
            if (savedState && !isPracticeMode) {
                restoreGameState(savedState);
            }
            
            // Store hint data for Game Shelf Hint Helper
            storeHintData();
            
            updateDisplay();
            updateDifficultyUI();
            updateConfirmationUI();
            updateShowIntroUI();
            initSoundToggle();
            
            // Check if first-time player
            if (!tutorialCompleted) {
                showTutorialChoice();
            } else if (showIntroOnStart && !skipIntroAfterTutorial) {
                showIntro();
            }
            skipIntroAfterTutorial = false;
        }
        
        function initSoundToggle() {
            const toggle = document.getElementById('sound-toggle');
            if (toggle) {
                toggle.checked = soundEnabled;
            }
        }

        // ============ TUTORIAL FUNCTIONS ============
        function showTutorialChoice() {
            document.getElementById('tutorial-choice-modal').classList.add('active');
        }
        
        function hideTutorialChoice() {
            document.getElementById('tutorial-choice-modal').classList.remove('active');
        }
        
        function startTutorial() {
            hideTutorialChoice();
            currentTutorialStep = 1;
            showTutorialWalkthrough();
        }
        
        function showTutorialWalkthrough() {
            updateTutorialStep();
            document.getElementById('tutorial-walkthrough-modal').classList.add('active');
        }
        
        function hideTutorialWalkthrough() {
            document.getElementById('tutorial-walkthrough-modal').classList.remove('active');
        }
        
        function updateTutorialStep() {
            // Hide all steps
            for (let i = 1; i <= totalTutorialSteps; i++) {
                document.getElementById(`tutorial-step-${i}`).style.display = 'none';
            }
            // Show current step
            document.getElementById(`tutorial-step-${currentTutorialStep}`).style.display = 'block';
            
            // Update step dots
            const dots = document.querySelectorAll('#tutorial-step-indicator .step-dot');
            dots.forEach((dot, i) => {
                dot.classList.remove('active', 'completed');
                if (i + 1 === currentTutorialStep) {
                    dot.classList.add('active');
                } else if (i + 1 < currentTutorialStep) {
                    dot.classList.add('completed');
                }
            });
            
            // Update navigation buttons
            const prevBtn = document.getElementById('tutorial-prev-btn');
            const nextBtn = document.getElementById('tutorial-next-btn');
            
            prevBtn.style.display = currentTutorialStep === 1 ? 'none' : 'block';
            nextBtn.textContent = currentTutorialStep === totalTutorialSteps ? "Let's Play! üéÆ" : 'Next ‚Üí';
        }
        
        function nextTutorialStep() {
            if (currentTutorialStep < totalTutorialSteps) {
                currentTutorialStep++;
                updateTutorialStep();
            } else {
                // End of walkthrough
                completeTutorial();
                skipIntroAfterTutorial = true;
                hideTutorialWalkthrough();
            }
        }
        
        function prevTutorialStep() {
            if (currentTutorialStep > 1) {
                currentTutorialStep--;
                updateTutorialStep();
            }
        }
        
        function exitTutorialWalkthrough() {
            completeTutorial();
            skipIntroAfterTutorial = true;
            hideTutorialWalkthrough();
        }
        
        function skipTutorial() {
            hideTutorialChoice();
            completeTutorial();
            // User said they've played before, so skip intro too
            // Also disable intro on start since they're experienced
            showIntroOnStart = false;
            localStorage.setItem('slateShowIntro', 'false');
            skipIntroAfterTutorial = true; // Extra safeguard to prevent intro
        }
        
        function completeTutorial() {
            tutorialCompleted = true;
            localStorage.setItem('slateTutorialDone', 'true');
        }
        
        function replayTutorial() {
            closeMenu();
            currentTutorialStep = 1;
            showTutorialWalkthrough();
        }
        
        function resetTutorialState() {
            localStorage.removeItem('slateTutorialDone');
            tutorialCompleted = false;
            closeMenu();
            showTutorialChoice();
        }

        function showIntro() {
            const modal = document.getElementById('intro-modal');
            modal.classList.add('active');
            document.getElementById('skip-intro-checkbox').checked = false;
            
            const content = modal.querySelector('.modal-content');
            const indicator = document.getElementById('intro-scroll-indicator');
            
            setTimeout(() => {
                if (content.scrollHeight <= content.clientHeight) {
                    indicator.classList.add('hidden');
                } else {
                    indicator.classList.remove('hidden');
                }
            }, 100);
            
            content.onscroll = function() {
                const scrolledToBottom = content.scrollTop + content.clientHeight >= content.scrollHeight - 50;
                if (scrolledToBottom) {
                    indicator.classList.add('hidden');
                }
            };
        }

        function closeIntro() {
            document.getElementById('intro-modal').classList.remove('active');
            
            if (document.getElementById('skip-intro-checkbox').checked) {
                showIntroOnStart = false;
                localStorage.setItem('slateShowIntro', 'false');
                updateShowIntroUI();
            }
        }

        function toggleShowIntro() {
            showIntroOnStart = document.getElementById('show-intro-toggle').checked;
            localStorage.setItem('slateShowIntro', showIntroOnStart ? 'true' : 'false');
        }

        function updateShowIntroUI() {
            document.getElementById('show-intro-toggle').checked = showIntroOnStart;
        }

        function setDifficulty(mode) {
            difficultyMode = mode;
            localStorage.setItem('slateDifficulty', mode);
            updateDifficultyUI();
        }

        function updateDifficultyUI() {
            const easyBtn = document.getElementById('easy-btn');
            const hardBtn = document.getElementById('hard-btn');
            
            if (difficultyMode === 'easy') {
                easyBtn.classList.add('active');
                hardBtn.classList.remove('active');
            } else {
                hardBtn.classList.add('active');
                easyBtn.classList.remove('active');
            }
        }

        function toggleConfirmation() {
            consonantConfirmation = document.getElementById('confirm-toggle').checked;
            localStorage.setItem('slateConsonantConfirm', consonantConfirmation);
        }

        function updateConfirmationUI() {
            const toggle = document.getElementById('confirm-toggle');
            if (toggle) {
                toggle.checked = consonantConfirmation;
            }
        }

        function showConfirmModal(letter) {
            pendingConsonant = letter;
            document.getElementById('confirm-letter').textContent = letter;
            document.getElementById('confirm-letter-text').textContent = letter;
            document.getElementById('confirm-modal').classList.add('active');
        }

        function confirmConsonantReveal() {
            document.getElementById('confirm-modal').classList.remove('active');
            if (pendingConsonant) {
                revealConsonantGlobally(pendingConsonant, true);
                pendingConsonant = null;
            }
        }

        function cancelConsonantReveal() {
            document.getElementById('confirm-modal').classList.remove('active');
            pendingConsonant = null;
        }

        function createGrid() {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';

            words.forEach((word, rowIndex) => {
                for (let i = 0; i < 5; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = rowIndex;
                    cell.dataset.col = i;
                    cell.dataset.letter = word[i];
                    cell.dataset.guessed = 'false';
                    
                    const letter = word[i];
                    
                    if (vowels.includes(letter)) {
                        cell.textContent = letter;
                        cell.classList.add('vowel');
                    } else {
                        cell.classList.add('empty');
                        cell.classList.add('clickable');
                        cell.onclick = () => openModalForSquare(cell);
                    }
                    
                    grid.appendChild(cell);
                }
                
                const scoreCell = document.createElement('div');
                scoreCell.className = 'word-score';
                scoreCell.id = `word-score-${rowIndex}`;
                scoreCell.textContent = '';
                grid.appendChild(scoreCell);
            });
        }

        function createBottomConsonants() {
            const container = document.getElementById('consonants');
            container.innerHTML = '';
            
            consonants.forEach(letter => {
                const btn = document.createElement('button');
                btn.className = 'consonant-btn';
                btn.textContent = letter;
                btn.onclick = () => revealConsonantGlobally(letter);
                btn.id = `bottom-btn-${letter}`;
                container.appendChild(btn);
            });
        }

        function createModalConsonants() {
            const container = document.getElementById('modal-consonants');
            container.innerHTML = '';
            
            consonants.forEach(letter => {
                const btn = document.createElement('button');
                btn.className = 'modal-consonant-btn';
                btn.textContent = letter;
                btn.id = `modal-btn-${letter}`;
                btn.type = 'button';
                
                btn.onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    if (!this.disabled) {
                        fillSquareWithConsonant(letter);
                    }
                };
                
                container.appendChild(btn);
            });
        }

        function openModalForSquare(cell) {
            if (gameOver) return;
            
            if (cell.classList.contains('vowel') || cell.classList.contains('guessed')) return;

            if (completedWordIndices.has(parseInt(cell.dataset.row))) return;
            
            selectedSquare = cell;
            
            const rowNum = parseInt(cell.dataset.row) + 1;
            const colNum = parseInt(cell.dataset.col) + 1;
            const label = document.getElementById('selected-square-label');
            if (label) {
                label.textContent = `Word ${rowNum}, Letter ${colNum}`;
            }
            
            cell.classList.add('selected');
            
            consonants.forEach(letter => {
                const btn = document.getElementById(`modal-btn-${letter}`);
                btn.disabled = false;
            });
            
            // Show clear button if cell has a guessed letter
            const clearBtn = document.getElementById('clear-letter-btn');
            if (cell.dataset.guessed === 'true' && cell.textContent !== '') {
                clearBtn.style.display = 'block';
            } else {
                clearBtn.style.display = 'none';
            }
            
            document.getElementById('consonant-modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('consonant-modal').classList.remove('active');
            if (selectedSquare) {
                selectedSquare.classList.remove('selected');
            }
            selectedSquare = null;
            // Hide clear button
            document.getElementById('clear-letter-btn').style.display = 'none';
        }

        function clearSelectedSquare() {
            if (!selectedSquare) return;
            
            // Only clear if it was a guessed consonant (not auto-revealed)
            if (selectedSquare.dataset.guessed === 'true') {
                selectedSquare.textContent = '';
                selectedSquare.classList.remove('consonant');
                selectedSquare.classList.add('empty', 'clickable');
                selectedSquare.dataset.guessed = 'false';
                
                playClickSound();
                showMessage('Letter cleared', 'success');
            }
            
            closeModal();
        }

        function openMenu() {
            document.getElementById('menu-modal').classList.add('active');
        }

        function closeMenu() {
            document.getElementById('menu-modal').classList.remove('active');
        }

        function fillSquareWithConsonant(letter) {
            if (!selectedSquare) return;
            
            playPlaceSound();
            
            const cellToFill = selectedSquare;
            const rowIndex = parseInt(cellToFill.dataset.row);
            const colIndex = parseInt(cellToFill.dataset.col);
            
            cellToFill.classList.remove('selected');
            
            closeModal();
            
            cellToFill.textContent = letter;
            cellToFill.classList.remove('empty');
            cellToFill.classList.add('consonant');
            cellToFill.dataset.guessed = 'true';
            cellToFill.onclick = () => openModalForSquare(cellToFill);
            
            saveGameState(); // v1.0.9: Persist progress
            
            if (isWordFilled(rowIndex)) {
                checkWord(rowIndex);
            }
        }

        function revealConsonantGlobally(letter, skipConfirmation = false) {
            if (gameOver) return;
            
            if (revealedConsonants.has(letter)) {
                showMessage('Already revealed!', 'error');
                return;
            }
            
            if (consonantConfirmation && !skipConfirmation) {
                showConfirmModal(letter);
                return;
            }
            
            consonantCount++;
            revealedConsonants.add(letter);
            
            const btn = document.getElementById(`bottom-btn-${letter}`);
            if (btn) {
                btn.disabled = true;
                btn.classList.add('used');
            }
            
            const modalBtn = document.getElementById(`modal-btn-${letter}`);
            if (modalBtn) {
                modalBtn.disabled = true;
                modalBtn.classList.add('used');
            }
            
            let revealCount = 0;
            
            words.forEach((word, rowIndex) => {
                if (!completedWordIndices.has(rowIndex)) {
                    for (let i = 0; i < 5; i++) {
                        if (word[i] === letter) {
                            const cell = document.querySelector(`[data-row="${rowIndex}"][data-col="${i}"]`);
                            if (cell.classList.contains('empty') || cell.classList.contains('consonant')) {
                                cell.textContent = letter;
                                cell.classList.remove('empty');
                                cell.classList.add('consonant');
                                cell.dataset.guessed = 'false';
                                revealCount++;
                            }
                        }
                    }
                }
            });
            
            showMessage(`+1 pts: Revealed ${revealCount} √ó ${letter}`, 'success');
            updateDisplay();
            saveGameState(); // v1.0.9: Persist progress
            
            words.forEach((word, rowIndex) => {
                if (!completedWordIndices.has(rowIndex) && isWordFilled(rowIndex)) {
                    setTimeout(() => checkWord(rowIndex), 300);
                }
            });
        }

        function isWordFilled(rowIndex) {
            for (let i = 0; i < 5; i++) {
                const cell = document.querySelector(`[data-row="${rowIndex}"][data-col="${i}"]`);
                if (cell.textContent === '') {
                    return false;
                }
            }
            return true;
        }

        function checkWord(rowIndex) {
            if (completedWordIndices.has(rowIndex)) return;
            
            const word = words[rowIndex];
            let guessedWord = '';
            
            for (let i = 0; i < 5; i++) {
                const cell = document.querySelector(`[data-row="${rowIndex}"][data-col="${i}"]`);
                guessedWord += cell.textContent;
            }
            
            if (guessedWord === word) {
                playWordCompleteSound();
                for (let i = 0; i < 5; i++) {
                    const cell = document.querySelector(`[data-row="${rowIndex}"][data-col="${i}"]`);
                    cell.style.background = '#5a7d5a';
                    cell.style.transform = 'scale(1.1)';
                }
                
                setTimeout(() => {
                    completeWord(rowIndex);
                }, 500);
            } else {
                playErrorSound();
                consonantCount++;
                
                for (let i = 0; i < 5; i++) {
                    const cell = document.querySelector(`[data-row="${rowIndex}"][data-col="${i}"]`);
                    cell.style.background = '#7a3a3a';
                    cell.style.transform = 'scale(1.05)';
                }
                
                setTimeout(() => {
                    // v1.0.16: Don't clear if game ended (letters already filled by checkPointLimit)
                    if (gameOver) return;
                    
                    for (let i = 0; i < 5; i++) {
                        const cell = document.querySelector(`[data-row="${rowIndex}"][data-col="${i}"]`);
                        cell.style.background = '';
                        cell.style.transform = '';
                        
                        if (cell.dataset.guessed === 'true') {
                            cell.textContent = '';
                            cell.classList.remove('consonant');
                            cell.classList.add('empty');
                            cell.classList.add('clickable');
                            cell.onclick = () => openModalForSquare(cell);
                            cell.dataset.guessed = 'false';
                        }
                    }
                    saveGameState(); // v1.0.9: Save after wrong word clears individual guesses
                }, 800);
                
                showMessage(`‚úó Wrong word! +1 penalty`, 'error');
                updateDisplay();
            }
        }

        function completeWord(rowIndex) {
            if (completedWordIndices.has(rowIndex)) return;
            
            completedWordIndices.add(rowIndex);
            wordsCompleted++;
            
            const wordScore = consonantCount;
            currentScore += wordScore;
            
            const word = words[rowIndex];
            
            if (difficultyMode === 'easy') {
                const wordConsonants = new Set();
                for (let i = 0; i < 5; i++) {
                    const letter = word[i];
                    if (!vowels.includes(letter)) {
                        wordConsonants.add(letter);
                    }
                }
                
                words.forEach((otherWord, otherRowIndex) => {
                    if (otherRowIndex === rowIndex || completedWordIndices.has(otherRowIndex)) return;
                    
                    for (let i = 0; i < 5; i++) {
                        const letter = otherWord[i];
                        if (wordConsonants.has(letter)) {
                            const cell = document.querySelector(`[data-row="${otherRowIndex}"][data-col="${i}"]`);
                            if (cell && cell.classList.contains('empty')) {
                                cell.textContent = letter;
                                cell.classList.remove('empty', 'clickable');
                                cell.classList.add('consonant');
                                cell.onclick = null;
                                cell.dataset.autoRevealed = 'true';
                            }
                        }
                    }
                });
                
                wordConsonants.forEach(letter => {
                    if (!revealedConsonants.has(letter)) {
                        revealedConsonants.add(letter);
                        
                        const btn = document.getElementById(`bottom-btn-${letter}`);
                        if (btn) {
                            btn.classList.add('used');
                            btn.disabled = true;
                        }
                        
                        const modalBtn = document.getElementById(`modal-btn-${letter}`);
                        if (modalBtn) {
                            modalBtn.classList.add('used');
                            modalBtn.disabled = true;
                        }
                    }
                });
                
                setTimeout(() => {
                    words.forEach((otherWord, otherRowIndex) => {
                        if (otherRowIndex !== rowIndex && !completedWordIndices.has(otherRowIndex) && isWordFilled(otherRowIndex)) {
                            checkWord(otherRowIndex);
                        }
                    });
                }, 600);
            }
            
            for (let i = 0; i < 5; i++) {
                const cell = document.querySelector(`[data-row="${rowIndex}"][data-col="${i}"]`);
                cell.style.background = '';
                cell.style.transform = '';
                cell.classList.remove('vowel', 'consonant', 'empty', 'clickable');
                cell.classList.add('guessed');
                cell.onclick = null;
            }
            
            const scoreCell = document.getElementById(`word-score-${rowIndex}`);
            scoreCell.textContent = wordScore;
            scoreCell.classList.add('visible');
            
            const modeText = difficultyMode === 'easy' ? ' (Easy mode: consonants auto-revealed!)' : '';
            showMessage(`üéØ ${word} complete! +${wordScore} points${modeText}`, 'success');
            updateDisplay();
            
            if (wordsCompleted === 8) {
                setTimeout(() => endGame(true), 500);
            } else {
                saveGameState(); // v1.0.9: Save after word completion (unless game is ending)
            }
        }

        function updateDisplay() {
            document.getElementById('score').textContent = currentScore;
            document.getElementById('consonants-count').textContent = consonantCount;
            document.getElementById('words-found').textContent = wordsCompleted;
            
            if (!gameOver) {
                if (currentScore >= POINT_LIMIT) {
                    checkPointLimit('üíÄ Point limit reached! Game Over!');
                } else if (consonantCount > 0) {
                    const wordsRemaining = 8 - wordsCompleted;
                    const minimumFutureScore = wordsRemaining * consonantCount;
                    const projectedMinScore = currentScore + minimumFutureScore;
                    
                    if (wordsRemaining > 0 && projectedMinScore > POINT_LIMIT) {
                        checkPointLimit(`üíÄ Impossible to win! ${wordsRemaining} words √ó ${consonantCount} pts = ${minimumFutureScore} more points needed`);
                    }
                }
            }
        }
        
        function checkPointLimit(message) {
            if (gameOver) return;
            gameOver = true;
            
            showMessage(message, 'error');
            
            words.forEach((word, rowIndex) => {
                if (!completedWordIndices.has(rowIndex)) {
                    for (let i = 0; i < 5; i++) {
                        const cell = document.querySelector(`[data-row="${rowIndex}"][data-col="${i}"]`);
                        const letter = word[i];
                        
                        // Always set the correct letter (overwrites any wrong guesses)
                        cell.textContent = letter;
                        
                        cell.classList.remove('vowel', 'consonant', 'empty', 'clickable');
                        cell.classList.add('failed');
                        cell.onclick = null;
                    }
                    
                    const scoreCell = document.getElementById(`word-score-${rowIndex}`);
                    scoreCell.textContent = '‚úó';
                    scoreCell.classList.add('visible', 'failed');
                }
            });
            
            consonants.forEach(letter => {
                const btn = document.getElementById(`bottom-btn-${letter}`);
                if (btn) btn.disabled = true;
                const modalBtn = document.getElementById(`modal-btn-${letter}`);
                if (modalBtn) modalBtn.disabled = true;
            });
            
            setTimeout(() => endGame(false), 1000);
        }

        function showMessage(text, type) {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.className = `message ${type} show`;
            
            setTimeout(() => {
                msg.classList.remove('show');
            }, 2000);
        }

        function endGame(won = true) {
            const gameOverEl = document.getElementById('game-over');
            gameOverEl.style.display = 'block';
            gameOver = true;
            
            // v1.0.9: Clear saved game state on completion
            clearGameState();
            
            // Play win or lose sound
            if (won) {
                playWinSound();
            } else {
                playLoseSound();
            }
            
            // Record practice result if in practice mode
            if (isPracticeMode) {
                recordPracticeResult(won, currentScore);
            }
            
            // Update and get stats
            const stats = updateStats(won, currentScore);
            
            // Report to Game Shelf
            reportToGameShelf(won, currentScore, stats);
            
            // Save today's result for "already played" check
            if (!isPracticeMode) {
                // Generate share text for later use
                const puzzleNum = Math.floor((new Date().setHours(0,0,0,0) - new Date('2026-01-09').setHours(0,0,0,0)) / (1000 * 60 * 60 * 24)) + 1;
                let gridDisplay = '';
                words.forEach((word, rowIndex) => {
                    let rowDisplay = '';
                    const isCompleted = completedWordIndices.has(rowIndex);
                    for (let i = 0; i < 5; i++) {
                        const letter = word[i];
                        if (!won && !isCompleted) rowDisplay += 'üü•';
                        else if (vowels.includes(letter)) rowDisplay += 'üü®';
                        else rowDisplay += 'üü©';
                    }
                    gridDisplay += rowDisplay + '\n';
                });
                let ratingEmoji = won ? (currentScore === 0 ? 'üèÜ' : currentScore <= 8 ? '‚≠ê‚≠ê‚≠ê' : currentScore <= 16 ? '‚≠ê‚≠ê' : currentScore <= 24 ? '‚≠ê' : currentScore <= 32 ? '‚ú®' : currentScore <= 40 ? 'üëç' : currentScore <= 48 ? 'üìö' : '‚úì') : 'üíÄ';
                let resultEmoji = won ? (currentScore === 0 ? 'üéØ' : '‚úÖ') : '‚ùå';
                const modeEmoji = difficultyMode === 'easy' ? 'üü¢' : 'üî¥';
                const modeLabel = difficultyMode === 'easy' ? 'Easy' : 'Hard';
                const scoreLine = won ? `Score: ${currentScore} ${ratingEmoji}` : `DNF (${wordsCompleted}/8) ${ratingEmoji}`;
                let modeLine = `${modeEmoji} ${modeLabel}`;
                if (stats.currentStreak > 1) modeLine += ` ¬∑ üî•${stats.currentStreak}`;
                const shareText = `ü™® Slate #${puzzleNum} ${resultEmoji}\n${gridDisplay}${scoreLine}\n${modeLine}\nslate.game`;
                
                saveTodayResult(won, currentScore, wordsCompleted, shareText, difficultyMode);
            }
            
            let rating, emoji, message, headerText, headerColor;
            
            if (!won) {
                rating = 'POINTS EXCEEDED';
                emoji = 'üíÄ';
                message = `You exceeded the ${POINT_LIMIT} point limit! Better luck tomorrow.`;
                headerText = '‚ùå POINTS EXCEEDED ‚ùå';
                headerColor = '#ff6666';
            } else if (currentScore === 0) {
                rating = 'PERFECT!';
                emoji = 'üèÜ';
                message = 'Impossible! You guessed every word from vowels alone!';
                headerText = 'üéØ GAME COMPLETE! üéØ';
                headerColor = '#ffd700';
            } else if (currentScore <= 8) {
                rating = 'MASTER';
                emoji = '‚≠ê‚≠ê‚≠ê';
                message = 'Outstanding performance! You\'re a word wizard!';
                headerText = 'üéØ GAME COMPLETE! üéØ';
                headerColor = '#ffd700';
            } else if (currentScore <= 16) {
                rating = 'EXPERT';
                emoji = '‚≠ê‚≠ê';
                message = 'Excellent work! Very impressive solving!';
                headerText = 'üéØ GAME COMPLETE! üéØ';
                headerColor = '#ffd700';
            } else if (currentScore <= 24) {
                rating = 'SKILLED';
                emoji = '‚≠ê';
                message = 'Great job! You have strong word skills!';
                headerText = 'üéØ GAME COMPLETE! üéØ';
                headerColor = '#ffd700';
            } else if (currentScore <= 32) {
                rating = 'PROFICIENT';
                emoji = '‚ú®';
                message = 'Well done! Solid performance!';
                headerText = 'üéØ GAME COMPLETE! üéØ';
                headerColor = '#ffd700';
            } else if (currentScore <= 40) {
                rating = 'COMPETENT';
                emoji = 'üëç';
                message = 'Good effort! You completed all the words!';
                headerText = 'üéØ GAME COMPLETE! üéØ';
                headerColor = '#ffd700';
            } else if (currentScore <= 48) {
                rating = 'DEVELOPING';
                emoji = 'üìö';
                message = 'Nice work! Keep practicing!';
                headerText = 'üéØ GAME COMPLETE! üéØ';
                headerColor = '#ffd700';
            } else {
                rating = 'COMPLETED';
                emoji = '‚úì';
                message = 'You finished the puzzle just under the limit!';
                headerText = 'üéØ GAME COMPLETE! üéØ';
                headerColor = '#ffd700';
            }
            
            const modeText = difficultyMode === 'easy' ? 'Easy Mode' : 'Hard Mode';
            const wordsCompletedText = won ? '8/8' : `${wordsCompleted}/8`;
            const wordsCompletedColor = won ? '#5a9a7a' : '#ff6666';
            
            gameOverEl.innerHTML = `
                <div class="game-over">
                    <h2 style="margin-bottom: 10px; color: ${headerColor};">${headerText}</h2>
                    
                    <div style="margin: 30px 0;">
                        <div style="font-size: 3.5rem; margin-bottom: 10px;">${emoji}</div>
                        <div style="font-size: 2rem; color: ${won ? '#ffd700' : '#ff6666'}; font-family: 'Permanent Marker', cursive; margin-bottom: 15px;">
                            ${rating}
                        </div>
                        <div class="final-score" style="font-size: 4rem; color: ${won ? '#f4e4c1' : '#ff6666'}; margin: 20px 0; font-weight: 700;">
                            ${currentScore}
                        </div>
                        <p style="font-size: 1.1rem; color: #c9b896; line-height: 1.6; max-width: 400px; margin: 0 auto;">
                            ${message}
                        </p>
                    </div>
                    
                    <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 8px; margin: 30px 0;">
                        <h3 style="font-family: 'Permanent Marker', cursive; color: #f4e4c1; margin-bottom: 15px;">
                            Your Performance
                        </h3>
                        <div style="color: #a8b896; font-size: 1rem; line-height: 2;">
                            <div>üéÆ Mode: <strong style="color: #d5a8a8;">${modeText}</strong></div>
                            <div>${won ? '‚úì' : '‚úó'} Words Completed: <strong style="color: ${wordsCompletedColor};">${wordsCompletedText}</strong></div>
                            <div>üìä Total Consonants Used: <strong style="color: #d5a8a8;">${consonantCount}</strong></div>
                            <div>üéØ Final Score: <strong style="color: ${won ? '#ffd700' : '#ff6666'};">${currentScore}</strong></div>
                            ${!won ? `<div>‚ö†Ô∏è Point Limit: <strong style="color: #ff6666;">${POINT_LIMIT}</strong></div>` : ''}
                        </div>
                    </div>
                    
                    ${generateStatsHTML(stats)}
                    
                    <button onclick="shareResults(${won})" style="margin: 20px 0; padding: 15px 40px; font-size: 1.1rem; background: ${won ? '#5a7d5a' : '#7a5a5a'}; display: flex; align-items: center; justify-content: center; gap: 10px; width: 100%; max-width: 300px; margin-left: auto; margin-right: auto;">
                        <span>üì§</span> Share Results
                    </button>
                    <div id="share-confirmation" style="font-size: 0.9rem; color: #5a9a7a; margin-bottom: 15px; opacity: 0; transition: opacity 0.3s;"></div>
                    
                    <div style="background: rgba(90,125,90,0.2); padding: 15px; border-radius: 8px; border: 2px solid rgba(90,125,90,0.4); margin: 20px 0;">
                        <div style="font-size: 0.9rem; color: #a8d5a8; line-height: 1.8;">
                            <strong>Score Ranges (Point Limit: ${POINT_LIMIT}):</strong><br>
                            0 = Perfect | 1-8 = Master | 9-16 = Expert<br>
                            17-24 = Skilled | 25-32 = Proficient<br>
                            33-40 = Competent | 41-48 = Developing | 49 = Completed
                        </div>
                    </div>
                    
                    <div style="font-size: 0.95rem; color: #a8b896; margin-top: 25px; line-height: 1.6;">
                        ‚è∞ Come back tomorrow for a new puzzle!
                    </div>
                </div>
            `;
            
            setTimeout(() => {
                gameOverEl.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }, 300);
        }
        
        // Report game result to Game Shelf
        function reportToGameShelf(won, score, stats) {
            const today = new Date();
            const launchDate = new Date('2026-01-09');
            launchDate.setHours(0, 0, 0, 0);
            today.setHours(0, 0, 0, 0);
            const puzzleNumber = Math.floor((today - launchDate) / (1000 * 60 * 60 * 24)) + 1;
            
            // Generate grid
            let grid = '';
            words.forEach((word, rowIndex) => {
                let rowDisplay = '';
                const isCompleted = completedWordIndices.has(rowIndex);
                for (let i = 0; i < 5; i++) {
                    const letter = word[i];
                    if (!won && !isCompleted) {
                        rowDisplay += 'üü•';
                    } else if (vowels.includes(letter)) {
                        rowDisplay += 'üü®';
                    } else {
                        rowDisplay += 'üü©';
                    }
                }
                grid += rowDisplay + '\n';
            });
            
            // Get rating emoji
            let ratingEmoji;
            if (!won) ratingEmoji = 'üíÄ';
            else if (score === 0) ratingEmoji = 'üèÜ';
            else if (score <= 8) ratingEmoji = '‚≠ê‚≠ê‚≠ê';
            else if (score <= 16) ratingEmoji = '‚≠ê‚≠ê';
            else if (score <= 24) ratingEmoji = '‚≠ê';
            else if (score <= 32) ratingEmoji = '‚ú®';
            else if (score <= 40) ratingEmoji = 'üëç';
            else if (score <= 48) ratingEmoji = 'üìö';
            else ratingEmoji = '‚úì';
            
            // Result emoji
            let resultEmoji = '‚ùå';
            if (won) {
                resultEmoji = score === 0 ? 'üéØ' : '‚úÖ';
            }
            
            const modeEmoji = difficultyMode === 'easy' ? 'üü¢' : 'üî¥';
            const modeLabel = difficultyMode === 'easy' ? 'Easy' : 'Hard';
            
            // Build score line
            const scoreLine = won ? `Score: ${score} ${ratingEmoji}` : `DNF (${wordsCompleted}/8) ${ratingEmoji}`;
            
            // Mode line with streak
            let modeLine = `${modeEmoji} ${modeLabel}`;
            if (stats && stats.currentStreak > 1) {
                modeLine += ` ¬∑ üî•${stats.currentStreak}`;
            }
            
            // Build share text
            const shareText = `ü™® Slate #${puzzleNumber} ${resultEmoji}
${grid}${scoreLine}
${modeLine}
slate.game`;
            
            GameShelfIntegration.reportComplete({
                puzzleNumber: puzzleNumber,
                puzzleId: today.toISOString().split('T')[0],
                won: won,
                score: score,
                perfect: won && score === 0,
                mode: difficultyMode,
                streak: {
                    current: stats ? stats.currentStreak : 0,
                    max: stats ? stats.maxStreak : 0
                },
                grid: grid.trim(),
                scoreLine: scoreLine,
                shareText: shareText,
                meta: {
                    consonantCount: consonantCount,
                    wordsCompleted: wordsCompleted,
                    rating: ratingEmoji
                }
            });
        }

        function shareResults(won = true) {
            const today = new Date();
            const launchDate = new Date('2026-01-09');
            launchDate.setHours(0, 0, 0, 0);
            today.setHours(0, 0, 0, 0);
            const puzzleNumber = Math.floor((today - launchDate) / (1000 * 60 * 60 * 24)) + 1;
            
            // Generate grid
            let gridDisplay = '';
            words.forEach((word, rowIndex) => {
                let rowDisplay = '';
                const isCompleted = completedWordIndices.has(rowIndex);
                for (let i = 0; i < 5; i++) {
                    const letter = word[i];
                    if (!won && !isCompleted) {
                        rowDisplay += 'üü•';
                    } else if (vowels.includes(letter)) {
                        rowDisplay += 'üü®';
                    } else {
                        rowDisplay += 'üü©';
                    }
                }
                gridDisplay += rowDisplay + '\n';
            });
            
            // Get rating emoji
            let ratingEmoji;
            if (!won) ratingEmoji = 'üíÄ';
            else if (currentScore === 0) ratingEmoji = 'üèÜ';
            else if (currentScore <= 8) ratingEmoji = '‚≠ê‚≠ê‚≠ê';
            else if (currentScore <= 16) ratingEmoji = '‚≠ê‚≠ê';
            else if (currentScore <= 24) ratingEmoji = '‚≠ê';
            else if (currentScore <= 32) ratingEmoji = '‚ú®';
            else if (currentScore <= 40) ratingEmoji = 'üëç';
            else if (currentScore <= 48) ratingEmoji = 'üìö';
            else ratingEmoji = '‚úì';
            
            // Result emoji
            let resultEmoji = '‚ùå';
            if (won) {
                resultEmoji = currentScore === 0 ? 'üéØ' : '‚úÖ';
            }
            
            const modeEmoji = difficultyMode === 'easy' ? 'üü¢' : 'üî¥';
            const modeLabel = difficultyMode === 'easy' ? 'Easy' : 'Hard';
            
            // Build score line
            const scoreLine = won ? `Score: ${currentScore} ${ratingEmoji}` : `DNF (${wordsCompleted}/8) ${ratingEmoji}`;
            
            // Get stats for streak
            const stats = JSON.parse(localStorage.getItem('slateStats') || '{}');
            let modeLine = `${modeEmoji} ${modeLabel}`;
            if (stats.currentStreak > 1) {
                modeLine += ` ¬∑ üî•${stats.currentStreak}`;
            }
            
            // Build standardized share text
            const shareText = `ü™® Slate #${puzzleNumber} ${resultEmoji}
${gridDisplay}${scoreLine}
${modeLine}
slate.game`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Slate',
                    text: shareText
                }).then(() => {
                    showShareConfirmation('‚úì Shared successfully!');
                }).catch(err => {
                    if (err.name !== 'AbortError') {
                        copyToClipboard(shareText);
                    }
                });
            } else {
                copyToClipboard(shareText);
            }
        }
        
        function copyToClipboard(text) {
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                    showShareConfirmation('‚úì Copied to clipboard! Paste to share.');
                }).catch(() => {
                    fallbackCopy(text);
                });
            } else {
                fallbackCopy(text);
            }
        }
        
        function fallbackCopy(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                showShareConfirmation('‚úì Copied to clipboard! Paste to share.');
            } catch (e) {
                showShareConfirmation('‚ùå Could not copy');
            }
            document.body.removeChild(textarea);
        }
        
        function showShareConfirmation(message) {
            const conf = document.getElementById('share-confirmation');
            if (conf) {
                conf.textContent = message;
                conf.style.opacity = '1';
                setTimeout(() => {
                    conf.style.opacity = '0';
                }, 2500);
            }
        }

        document.addEventListener('keydown', (e) => {
            // Ignore keyboard during tutorial walkthrough
            if (document.getElementById('tutorial-walkthrough-modal').classList.contains('active') ||
                document.getElementById('tutorial-choice-modal').classList.contains('active')) {
                if (e.key === 'Escape') {
                    exitTutorialWalkthrough();
                }
                return;
            }
            
            if (e.key === 'Escape') {
                closeModal();
                closeMenu();
                cancelConsonantReveal();
                return;
            }
            
            if (e.key === 'Enter' && document.getElementById('confirm-modal').classList.contains('active')) {
                e.preventDefault();
                confirmConsonantReveal();
                return;
            }
            
            // Backspace/Delete to clear letter in modal
            if ((e.key === 'Backspace' || e.key === 'Delete') &&
                document.getElementById('consonant-modal').classList.contains('active') &&
                selectedSquare && selectedSquare.dataset.guessed === 'true') {
                e.preventDefault();
                clearSelectedSquare();
                return;
            }
            
            const key = e.key.toUpperCase();
            
            if (key.length === 1 && key >= 'A' && key <= 'Z') {
                e.preventDefault();
                
                if (gameOver) return;
                
                if (document.getElementById('confirm-modal').classList.contains('active')) return;
                
                if (consonants.includes(key)) {
                    if (selectedSquare || document.getElementById('consonant-modal').classList.contains('active')) {
                        fillSquareWithConsonant(key);
                    } else {
                        if (consonantConfirmation) {
                            if (revealedConsonants.has(key)) {
                                showMessage('Already revealed!', 'error');
                            } else {
                                showConfirmModal(key);
                            }
                        } else {
                            revealConsonantGlobally(key, true);
                        }
                    }
                }
            }
        });

        document.getElementById('consonant-modal').addEventListener('click', (e) => {
            if (e.target.id === 'consonant-modal') {
                e.stopPropagation();
                closeModal();
            }
        });

        document.getElementById('menu-modal').addEventListener('click', (e) => {
            if (e.target.id === 'menu-modal') {
                e.stopPropagation();
                closeMenu();
            }
        });

        document.getElementById('confirm-modal').addEventListener('click', (e) => {
            if (e.target.id === 'confirm-modal') {
                e.stopPropagation();
                cancelConsonantReveal();
            }
        });

        document.querySelectorAll('.modal-content').forEach(content => {
            content.addEventListener('click', (e) => {
                e.stopPropagation();
            });
        });

        // Initialize Game Shelf Integration
        GameShelfIntegration.init('slate', {
            name: 'Slate',
            icon: 'ü™®',
            url: 'slate.game',
            version: '1.0.16',
            type: 'daily'
        });

        // Initialize Plain Mode
        applyPlainMode();
        initPlainModeToggle();
        
        // Initialize Cloud Sync (GSAuth)
        GSAuth.init('slate', {
            stats: 'slateStats',
            practice: 'slatePracticeStats'
        });

        initGame();
    </script>
    
    <!-- PWA Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('[Slate] SW registered');
                        setInterval(() => registration.update(), 60 * 60 * 1000);
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    if (confirm('New version of Slate available! Reload?')) {
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch((error) => console.log('[Slate] SW failed:', error));
            });
        }
        
    </script>
</body>
</html>
